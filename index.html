<!-- =========================
PART 1 / 3 â€” bank.html
(Keep EXACT order. Paste Part 2 directly under this, then Part 3 under Part 2.)
========================= -->
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Orion Gem Bank â€” Universal</title>
  <link href="https://fonts.googleapis.com/css2?family=Fredoka:wght@400;600;700&display=swap" rel="stylesheet">
  <style>
    *{box-sizing:border-box;font-family:'Fredoka',sans-serif}
    :root{
      --bgA:#9ec5ff;
      --bgB:#b9d7ff;

      --card:#ffffff;
      --soft:#f6f6f6;
      --stroke:rgba(0,0,0,.10);
      --stroke2:rgba(0,0,0,.06);

      --orange:#ff9f1c;
      --blue:#4dabf7;
      --green:#3adb76;
      --red:#ff4d6d;
      --purple:#845ef7;

      --ink:#121212;
      --muted:#666;

      --shadow:0 18px 50px rgba(0,0,0,.18);
      --shadow2:0 14px 34px rgba(0,0,0,.12);

      --r1:26px;
      --r2:22px;
      --r3:18px;
      --r4:14px;

      --sidebarW: 320px;
    }

    body{
      margin:0;
      min-height:100vh;
      background:linear-gradient(135deg,var(--bgA),var(--bgB));
      color:var(--ink);
      overflow-x:hidden;
    }

    /* ====== Desktop Layout ====== */
    .layout{
      display:grid;
      grid-template-columns: var(--sidebarW) 1fr;
      min-height:100vh;
    }

    /* ====== Sidebar ====== */
    .sidebar{
      position:sticky;
      top:0;
      height:100vh;
      padding:18px 16px;
      background:rgba(255,255,255,.85);
      backdrop-filter: blur(10px);
      border-right:2px solid rgba(0,0,0,.08);
      box-shadow: 14px 0 40px rgba(0,0,0,.12);
      overflow:auto;
    }

    .brand{
      background:var(--orange);
      color:#fff;
      border-radius:22px;
      padding:14px 14px;
      font-weight:1000;
      font-size:20px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      box-shadow:0 14px 26px rgba(255,159,28,.25);
      position:relative;
      overflow:hidden;
    }
    .brand:before{
      content:"";
      position:absolute;
      width:220px;height:220px;
      right:-120px; top:-120px;
      background:rgba(255,255,255,.20);
      border-radius:70px;
      transform:rotate(18deg);
    }
    .brand span{position:relative; z-index:2}

    .sideBlock{
      margin-top:14px;
      background:#fff;
      border:1px solid var(--stroke2);
      border-radius:22px;
      padding:12px;
      box-shadow:var(--shadow2);
    }

    .sideTitle{font-weight:1000;margin:4px 0 10px;font-size:16px}
    .sideSub{font-size:12px;color:var(--muted);font-weight:900}

    .nav{
      margin-top:10px;
      display:flex;
      flex-direction:column;
      gap:10px;
    }
    .nav button{
      width:100%;
      text-align:left;
      border:none;
      cursor:pointer;
      padding:12px 12px;
      border-radius:18px;
      font-weight:1000;
      background:#f4f4f4;
      border:1px solid rgba(0,0,0,.10);
      transition: transform .08s ease, background .2s ease, box-shadow .2s ease;
    }
    .nav button:hover{box-shadow:0 10px 20px rgba(0,0,0,.10)}
    .nav button:active{transform:translateY(1px)}
    .nav button.active{
      background:var(--blue);
      color:#fff;
      border-color: rgba(77,171,247,.45);
      box-shadow:0 14px 26px rgba(77,171,247,.22);
    }

    .sideActions{
      margin-top:12px;
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap:10px;
    }

    .btn{
      border:none;
      cursor:pointer;
      border-radius:18px;
      padding:12px 12px;
      font-weight:1000;
      box-shadow:0 14px 26px rgba(0,0,0,.12);
      transition:transform .08s ease, filter .2s ease;
    }
    .btn:active{transform:translateY(1px)}
    .btn.orange{background:var(--orange);color:#fff}
    .btn.gray{background:#f1f1f1;color:#111;border:1px solid rgba(0,0,0,.10);box-shadow:none}
    .btn.red{background:var(--red);color:#fff}
    .btn.green{background:var(--green);color:#fff}
    .btn.blue{background:var(--blue);color:#fff}
    .btn.purple{background:var(--purple);color:#fff}

    /* ====== Main ====== */
    .main{
      padding:22px 22px 28px 22px;
      max-width: 1400px;
    }

    .topRow{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:14px;
      margin-bottom:14px;
    }

    .welcomeCard{
      flex:1;
      background:rgba(255,255,255,.86);
      border:1px solid rgba(0,0,0,.08);
      border-radius:26px;
      padding:16px 16px;
      box-shadow:var(--shadow2);
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;
    }
    .welcomeTitle{
      font-size:22px;
      font-weight:1000;
      margin:0;
      line-height:1.1;
    }
    .welcomeSub{
      margin-top:6px;
      font-size:13px;
      font-weight:900;
      color:var(--muted);
    }
    .statusPill{
      display:inline-flex;
      align-items:center;
      gap:8px;
      padding:10px 12px;
      border-radius:999px;
      background:#fff;
      border:1px solid rgba(0,0,0,.10);
      font-weight:1000;
      white-space:nowrap;
    }

    /* Profile panel rectangle */
    .profilePanel{
      background:#fff;
      border-radius:26px;
      border:3px solid rgba(255,159,28,.55);
      box-shadow:var(--shadow);
      padding:14px;
      display:flex;
      align-items:center;
      gap:14px;
      min-width: 520px;
    }

    .avatar{
      width:74px;height:74px;
      border-radius:20px;
      background:#e9e9e9;
      border:2px solid rgba(0,0,0,.10);
      display:flex;
      align-items:center;
      justify-content:center;
      overflow:hidden;
      flex:0 0 auto;
      position:relative;
    }

    /* animated dashed placeholder when not logged in */
    .avatar.placeholder{
      background:#dcdcdc;
      border:2px solid transparent;
    }
    .avatar.placeholder:before{
      content:"";
      position:absolute;
      inset:-4px;
      border-radius:24px;
      background:
        repeating-linear-gradient(90deg,
          rgba(0,0,0,.25) 0 10px,
          rgba(0,0,0,0) 10px 18px);
      -webkit-mask:
        linear-gradient(#000 0 0) content-box,
        linear-gradient(#000 0 0);
      -webkit-mask-composite: xor;
      mask-composite: exclude;
      padding:6px;
      opacity:.8;
      animation: dashMove 1.2s linear infinite;
    }
    @keyframes dashMove{
      to{ transform:translateX(18px); }
    }

    .avatar img{
      width:100%;
      height:100%;
      object-fit:cover;
      display:block;
    }

    .pInfo{flex:1;min-width:0}
    .pName{font-size:18px;font-weight:1000;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
    .pMeta{margin-top:6px;display:flex;gap:10px;flex-wrap:wrap}
    .pill{
      display:inline-flex;
      align-items:center;
      gap:8px;
      padding:8px 10px;
      border-radius:999px;
      background:var(--soft);
      border:1px solid rgba(0,0,0,.10);
      font-weight:1000;
      font-size:12px;
    }
    .pill.blue{background:rgba(77,171,247,.16);border-color:rgba(77,171,247,.30)}
    .pill.orange{background:rgba(255,159,28,.18);border-color:rgba(255,159,28,.35)}
    .pill.green{background:rgba(58,219,118,.18);border-color:rgba(58,219,118,.35)}
    .pill.red{background:rgba(255,77,109,.18);border-color:rgba(255,77,109,.35)}
    .pill.purple{background:rgba(132,94,247,.16);border-color:rgba(132,94,247,.30)}

    .balanceLine{
      margin-top:10px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;
      padding:12px 12px;
      border-radius:18px;
      background:linear-gradient(135deg, rgba(77,171,247,.16), rgba(255,159,28,.18));
      border:1px solid rgba(0,0,0,.08);
    }
    .balLabel{font-weight:1000}
    .balValue{font-weight:1000;font-size:18px}

    /* Content grid */
    .contentGrid{
      display:grid;
      grid-template-columns: 1.4fr 1fr;
      gap:16px;
      margin-top:16px;
    }

    .panel{
      background:rgba(255,255,255,.88);
      border:1px solid rgba(0,0,0,.08);
      border-radius:26px;
      box-shadow:var(--shadow2);
      padding:14px;
    }
    .panelHeader{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;
      margin-bottom:10px;
    }
    .panelTitle{
      font-size:18px;
      font-weight:1000;
      margin:0;
    }
    .panelSub{
      font-size:12px;
      font-weight:900;
      color:var(--muted);
      margin-top:6px;
    }

    .divider{height:1px;background:rgba(0,0,0,.10);margin:12px 0}

    /* Forms */
    label{font-size:13px;font-weight:1000}
    input, textarea, select{
      width:100%;
      border-radius:16px;
      border:1px solid rgba(0,0,0,.12);
      padding:12px 12px;
      font-weight:800;
      margin-top:8px;
      outline:none;
      background:#fff;
    }
    textarea{min-height:110px;resize:vertical}

    .row2{display:grid;grid-template-columns:1fr 1fr;gap:12px}
    .row3{display:grid;grid-template-columns:1fr 1fr 1fr;gap:12px}
    .error{color:#b00020;font-weight:1000;font-size:12px;margin-top:8px}
    .ok{color:#0a7a3a;font-weight:1000;font-size:12px;margin-top:8px}

    /* List items */
    .list{display:flex;flex-direction:column;gap:10px;margin-top:8px}
    .item{
      display:flex;
      align-items:center;
      gap:12px;
      background:#f1f1f1;
      border:1px solid rgba(0,0,0,.08);
      border-radius:18px;
      padding:12px;
    }
    .iIcon{
      width:46px;height:46px;
      border-radius:16px;
      background:#fff;
      border:1px solid rgba(0,0,0,.10);
      box-shadow:0 10px 20px rgba(0,0,0,.10);
      display:flex;align-items:center;justify-content:center;
      font-size:18px;
      flex:0 0 auto;
    }
    .iMain{flex:1;min-width:0}
    .iTop{font-weight:1000;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
    .iSub{font-size:12px;color:var(--muted);font-weight:900;margin-top:4px}
    .iAmt{font-weight:1000;white-space:nowrap}
    .pos{color:#0a7a3a}
    .neg{color:#b00020}

    /* Views */
    .view{display:none}
    .view.show{display:block}

    /* Modal */
    .modal{
      position:fixed;
      inset:0;
      background:rgba(0,0,0,.6);
      display:none;
      align-items:center;
      justify-content:center;
      padding:16px;
      z-index:50;
    }
    .modalBox{
      width:min(560px, 100%);
      background:#fff;
      border-radius:22px;
      border:1px solid rgba(0,0,0,.10);
      box-shadow:0 18px 60px rgba(0,0,0,.30);
      padding:14px;
      position:relative;
    }
    .modalTitle{font-size:18px;font-weight:1000;text-align:center;margin:6px 0}
    .modalSub{font-size:12px;font-weight:900;color:var(--muted);text-align:center;margin-bottom:10px}
    .closeX{
      position:absolute;
      right:-12px; top:-12px;
      width:44px;height:44px;
      border-radius:16px;
      border:2px solid rgba(0,0,0,.15);
      background:var(--red);
      color:#fff;
      font-weight:1000;
      font-size:22px;
      cursor:pointer;
      box-shadow:0 12px 24px rgba(0,0,0,.20);
    }

    /* Leaderboard podium */
    .podium{
      display:grid;
      grid-template-columns: 1fr 1fr 1fr;
      gap:12px;
      margin-top:10px;
    }
    .podCard{
      background:#fff;
      border:1px solid rgba(0,0,0,.10);
      border-radius:22px;
      padding:12px;
      box-shadow:var(--shadow2);
      text-align:center;
      position:relative;
      overflow:hidden;
    }
    .podCard:before{
      content:"";
      position:absolute; inset:-40px;
      background:radial-gradient(circle at 30% 20%, rgba(255,159,28,.22), transparent 55%),
                 radial-gradient(circle at 70% 80%, rgba(77,171,247,.22), transparent 55%);
      transform:rotate(10deg);
    }
    .podCard > *{position:relative; z-index:2}
    .podAvatar{
      width:64px;height:64px;border-radius:999px;background:#e9e9e9;
      border:3px solid rgba(0,0,0,.10);
      margin:0 auto 8px;
      overflow:hidden;
    }
    .podAvatar img{width:100%;height:100%;object-fit:cover;display:block}
    .podPlace{font-weight:1000;font-size:12px;color:var(--muted)}
    .podName{font-weight:1000;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
    .podBal{font-weight:1000;margin-top:6px}
    .podRole{display:inline-flex;margin-top:8px}

    /* Blog cards grid */
    .grid3{
      display:grid;
      grid-template-columns: 1fr 1fr 1fr;
      gap:12px;
    }
    .blogCard{
      background:#fff;
      border:1px solid rgba(0,0,0,.10);
      border-radius:22px;
      overflow:hidden;
      box-shadow:var(--shadow2);
      cursor:pointer;
      transition: transform .08s ease;
    }
    .blogCard:active{transform:translateY(1px)}
    .blogCover{
      height:120px;
      background:#e9e9e9;
      overflow:hidden;
    }
    .blogCover img{width:100%;height:100%;object-fit:cover;display:block}
    .blogBody{padding:12px}
    .blogTitle{font-weight:1000}
    .blogMeta{font-size:12px;color:var(--muted);font-weight:900;margin-top:6px}
    .blogPrev{font-size:12px;color:#333;font-weight:800;margin-top:10px;line-height:1.35}

    /* Events panel */
    .bigSoon{
      display:flex;
      align-items:center;
      justify-content:center;
      min-height:300px;
      border-radius:22px;
      border:2px dashed rgba(0,0,0,.22);
      background:rgba(255,255,255,.65);
      font-size:44px;
      font-weight:1000;
      letter-spacing:1px;
      opacity:.9;
    }
    .eventBar{
      background:#fff;
      border:1px solid rgba(0,0,0,.10);
      border-radius:22px;
      box-shadow:var(--shadow2);
      padding:12px;
      display:flex;
      gap:12px;
      align-items:flex-start;
    }
    .eventA{
      width:54px;height:54px;border-radius:18px;background:#e9e9e9;overflow:hidden;border:2px solid rgba(0,0,0,.10);
      flex:0 0 auto;
    }
    .eventA img{width:100%;height:100%;object-fit:cover;display:block}
    .eventT{flex:1;min-width:0}
    .eventTop{font-weight:1000}
    .eventText{margin-top:6px;color:#222;font-weight:900;font-size:12.5px;white-space:pre-wrap}
    .eventTime{margin-top:8px;color:var(--muted);font-weight:900;font-size:11px}

    /* Chest */
    .chestHero{
      background:#fff;
      border:1px solid rgba(0,0,0,.10);
      border-radius:26px;
      box-shadow:var(--shadow2);
      padding:14px;
      position:relative;
      overflow:hidden;
    }
    .chestHero:before{
      content:"";
      position:absolute; inset:-60px;
      background:radial-gradient(circle at 25% 20%, rgba(255,159,28,.22), transparent 55%),
                 radial-gradient(circle at 70% 80%, rgba(58,219,118,.18), transparent 55%),
                 radial-gradient(circle at 80% 20%, rgba(132,94,247,.16), transparent 55%);
      transform:rotate(6deg);
    }
    .chestHero > *{position:relative; z-index:2}
    .rewardRow{display:flex;align-items:center;justify-content:space-between;gap:10px;padding:10px 12px;background:#f1f1f1;border:1px solid rgba(0,0,0,.08);border-radius:18px}
    .rewardLeft{display:flex;align-items:center;gap:10px;min-width:0}
    .rewardIcon{width:40px;height:40px;border-radius:14px;background:#fff;border:1px solid rgba(0,0,0,.10);display:flex;align-items:center;justify-content:center;box-shadow:0 10px 20px rgba(0,0,0,.10)}
    .rewardName{font-weight:1000;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
    .rewardPct{font-weight:1000;color:var(--muted);white-space:nowrap}

    /* âœ… Scrollable feed panel */
    .scrollPanel{
      max-height: 340px;
      overflow:auto;
      padding-right:6px;
    }
    .scrollPanel::-webkit-scrollbar{width:10px}
    .scrollPanel::-webkit-scrollbar-thumb{background:rgba(0,0,0,.18);border-radius:999px}
    .scrollPanel::-webkit-scrollbar-track{background:rgba(0,0,0,.06);border-radius:999px}

    /* Inventory tags */
    .tag{
      display:inline-flex;
      align-items:center;
      padding:6px 10px;
      border-radius:999px;
      border:1px solid rgba(0,0,0,.10);
      font-weight:1000;
      font-size:12px;
      background:#fff;
      white-space:nowrap;
    }
    .tag.gray{background:#f3f3f3}
    .tag.green{background:rgba(58,219,118,.18);border-color:rgba(58,219,118,.35)}
    .tag.red{background:rgba(255,77,109,.18);border-color:rgba(255,77,109,.35)}
    .tag.blue{background:rgba(77,171,247,.16);border-color:rgba(77,171,247,.30)}
    .tag.orange{background:rgba(255,159,28,.18);border-color:rgba(255,159,28,.35)}
    .miniBtns{display:flex;gap:8px;flex-wrap:wrap;justify-content:flex-end}

    /* Announce modal animation */
    @keyframes popShake{
      0%{transform:scale(.96)}
      45%{transform:scale(1.02)}
      65%{transform:scale(.99)}
      85%{transform:scale(1.01)}
      100%{transform:scale(1)}
    }

    /* ====== Hall of Fame ====== */
    .hofWrap{
      display:grid;
      grid-template-columns: repeat(5, 1fr);
      gap:12px;
      margin-top:10px;
    }
    .hofCard{
      background:#fff;
      border:1px solid rgba(0,0,0,.10);
      border-radius:22px;
      box-shadow:var(--shadow2);
      padding:12px;
      text-align:center;
      position:relative;
      overflow:hidden;
    }
    .hofCard:before{
      content:"";
      position:absolute; inset:-40px;
      background:radial-gradient(circle at 30% 20%, rgba(255,159,28,.18), transparent 55%),
                 radial-gradient(circle at 70% 80%, rgba(77,171,247,.18), transparent 55%);
      transform:rotate(10deg);
    }
    .hofCard > *{position:relative; z-index:2}
    .hofRing{
      width:84px;height:84px;border-radius:999px;
      margin:0 auto 10px;
      background:linear-gradient(135deg, rgba(255,159,28,.35), rgba(77,171,247,.35));
      padding:4px;
      box-shadow:0 14px 26px rgba(0,0,0,.14);
    }
    .hofPic{
      width:100%;height:100%;
      border-radius:999px;
      background:#e9e9e9;
      border:2px solid rgba(0,0,0,.10);
      overflow:hidden;
      display:flex;align-items:center;justify-content:center;
      font-size:26px;
    }
    .hofPic img{width:100%;height:100%;object-fit:cover;display:block}
    .hofName{
      font-weight:1000;
      white-space:nowrap;overflow:hidden;text-overflow:ellipsis;
    }
    .hofRole{
      margin-top:6px;
      font-size:12px;
      color:var(--muted);
      font-weight:900;
      white-space:nowrap;overflow:hidden;text-overflow:ellipsis;
    }

    .depositBox{
      background:#fff;
      border:1px solid rgba(0,0,0,.10);
      border-radius:22px;
      box-shadow:var(--shadow2);
      padding:12px;
      display:flex;
      gap:12px;
      align-items:flex-start;
    }
    .depA{
      width:64px;height:64px;border-radius:20px;background:#e9e9e9;overflow:hidden;border:2px solid rgba(0,0,0,.10);
      flex:0 0 auto;
      box-shadow:0 10px 20px rgba(0,0,0,.10);
      display:flex;align-items:center;justify-content:center;
      font-size:22px;
    }
    .depA img{width:100%;height:100%;object-fit:cover;display:block}
    .depT{flex:1;min-width:0}
    .depTitle{font-weight:1000}
    .depUser{
      margin-top:6px;
      font-weight:1000;
      font-size:16px;
    }
    .depNote{
      margin-top:8px;
      color:#222;
      font-weight:900;
      font-size:12.5px;
      white-space:pre-wrap;
    }

    /* Responsive */
    @media (max-width: 1200px){
      .grid3{grid-template-columns:1fr 1fr;}
      .hofWrap{grid-template-columns: repeat(3, 1fr);}
    }
    @media (max-width: 1050px){
      :root{ --sidebarW: 280px; }
      .profilePanel{min-width: 420px;}
      .contentGrid{grid-template-columns:1fr; }
      .hofWrap{grid-template-columns: repeat(3, 1fr);}
    }
    @media (max-width: 820px){
      .layout{grid-template-columns:1fr;}
      .sidebar{position:relative;height:auto}
      .profilePanel{min-width:unset}
      .topRow{flex-direction:column;align-items:stretch}
      .grid3{grid-template-columns:1fr;}
      .hofWrap{grid-template-columns: repeat(2, 1fr);}
    }
  </style>
</head>
<body>
  <div class="layout">

    <!-- LEFT SIDEBAR -->
    <aside class="sidebar">
      <div class="brand">
        <span>Orion Bank ğŸ’</span>
        <span style="font-weight:1000;opacity:.95">Universal</span>
      </div>

      <div class="sideBlock">
        <div class="sideTitle">Navigation</div>
        <div class="sideSub">Universal app â€¢ works on any browser</div>

        <div class="nav">
          <button id="nav_dash" class="active" onclick="switchView('dash')">ğŸ  Dashboard</button>
          <button id="nav_bank" onclick="switchView('bank')">ğŸ¦ Bank</button>
          <button id="nav_requests" onclick="switchView('requests')">ğŸ“¥ Requests</button>
          <button id="nav_leaderboard" onclick="switchView('leaderboard')">ğŸ† Leaderboard</button>
          <button id="nav_redeem" onclick="switchView('redeem')">ğŸ« Redeem Codes</button>
          <button id="nav_chest" onclick="switchView('chest')">ğŸ Chest</button>
          <button id="nav_inventory" onclick="switchView('inventory')">ğŸ’ Inventory</button>
          <button id="nav_events" onclick="switchView('events')">âš¡ Events</button>
          <button id="nav_blogs" onclick="switchView('blogs')">ğŸ“° Blogs</button>

          <!-- âœ… NEW -->
          <button id="nav_hof" onclick="switchView('hof')">ğŸŒŸ Hall of Fame</button>

          <button id="nav_admin" style="display:none" onclick="switchView('admin')">ğŸ›¡ï¸ Admin</button>
        </div>

        <div class="divider"></div>

        <div class="sideTitle">Account</div>
        <div class="sideActions">
          <button class="btn orange" onclick="openAuth(false)">Login</button>
          <button class="btn blue" onclick="openAuth(true)">Register</button>
        </div>
        <button class="btn red" style="width:100%;margin-top:10px;display:none" id="logoutBtn" onclick="logout()">Logout</button>

        <div class="divider"></div>
        <div class="sideSub" id="sideUser">Not signed in</div>
        <div class="sideSub" id="sideNote" style="margin-top:8px">Tip: each browser is its own session (normal).</div>
      </div>

      <div class="sideBlock">
        <div class="sideTitle">Live</div>
        <div class="sideSub">Auto refresh every 3s</div>
        <div class="divider"></div>
        <div class="sideSub" id="lastSync">Last sync: â€”</div>
        <div class="sideSub" id="apiStatus">API: â€”</div>
      </div>
    </aside>

    <!-- MAIN -->
    <main class="main">

      <!-- TOP ROW -->
      <div class="topRow">
        <div class="welcomeCard">
          <div>
            <h1 class="welcomeTitle" id="welcomeTitle">Welcome to Orion ğŸ’</h1>
            <div class="welcomeSub" id="welcomeSub">Login to access your bank profile.</div>
          </div>
          <div class="statusPill">
            <span>ğŸ›¡ï¸</span>
            <span id="modeText">Guest Mode</span>
          </div>
        </div>

        <!-- PROFILE RECTANGLE PANEL -->
        <div class="profilePanel">
          <div class="avatar placeholder" id="avatarBox"></div>

          <div class="pInfo">
            <div class="pName" id="pName">Guest</div>

            <div class="pMeta">
              <span class="pill orange" id="rolePill">Role: â€”</span>
              <span class="pill blue" id="idPill">ID: â€”</span>
              <span class="pill purple" id="tokenPill">ğŸ¥ Tokens: â€”</span>
              <span class="pill green" id="adminPill" style="display:none">Admin</span>
            </div>

            <div class="balanceLine">
              <div class="balLabel">Balance</div>
              <div class="balValue" id="balText">0 ğŸ’</div>
            </div>
          </div>
        </div>
      </div>

      <!-- DASH -->
      <div class="view show" id="view_dash">
        <div class="contentGrid">
          <section class="panel">
            <div class="panelHeader">
              <div>
                <h2 class="panelTitle">Overview</h2>
                <div class="panelSub">Live state + activity</div>
              </div>
              <span class="pill green" id="statusPill">Ready</span>
            </div>

            <div class="row3">
              <div class="panel" style="padding:12px;border-radius:22px;background:#fff;border:1px solid rgba(0,0,0,.08)">
                <div style="font-weight:1000">Your Gems</div>
                <div style="margin-top:8px;font-size:26px;font-weight:1000" id="dashBal">0 ğŸ’</div>
                <div class="panelSub" style="margin-top:8px">Live refresh</div>
              </div>
              <div class="panel" style="padding:12px;border-radius:22px;background:#fff;border:1px solid rgba(0,0,0,.08)">
                <div style="font-weight:1000">ğŸ¥ Tokens</div>
                <div style="margin-top:8px;font-size:26px;font-weight:1000" id="dashTok">0 ğŸ¥</div>
                <div class="panelSub" style="margin-top:8px">Used for chests</div>
              </div>
              <div class="panel" style="padding:12px;border-radius:22px;background:#fff;border:1px solid rgba(0,0,0,.08)">
                <div style="font-weight:1000">Role Rank</div>
                <div style="margin-top:8px;font-size:22px;font-weight:1000" id="dashRole">â€”</div>
                <div class="panelSub" style="margin-top:8px">Based on balance</div>
              </div>
            </div>

            <div class="divider"></div>

            <div class="panelSub" style="font-weight:1000">Recent Activity</div>
            <div class="list" id="txList"></div>
            <div class="panelSub" id="txEmpty" style="display:none;margin-top:8px">No activity yet.</div>
          </section>

          <section class="panel">
            <div class="panelHeader">
              <div>
                <h2 class="panelTitle">Quick Actions</h2>
                <div class="panelSub">Requests + convert</div>
              </div>
              <span class="pill orange">âš™ï¸</span>
            </div>

            <button class="btn green" style="width:100%" onclick="openReq('deposit')">+ Deposit Request</button>
            <button class="btn orange" style="width:100%;margin-top:10px" onclick="openReq('withdraw')">- Withdraw Request</button>

            <div class="divider"></div>

            <button class="btn purple" style="width:100%" onclick="openConvert()">ğŸ¥ Convert Gems â†’ Tokens</button>
            <div class="panelSub" style="margin-top:10px">
              Conversion rate: <b>8,000,000 ğŸ’ = 500 ğŸ¥</b> (500-step only).
            </div>

            <div class="divider"></div>
            <div class="panelSub" style="font-weight:1000">Inventory Exchange</div>
            <button class="btn blue" style="width:100%;margin-top:10px" onclick="switchView('inventory')">Go ğŸ’ Inventory</button>
            <div class="panelSub" style="margin-top:8px">
              Huge â†’ <b>9,000,000 ğŸ’</b><br>
              Titanic â†’ <b>4,400,000,000 ğŸ’</b>
            </div>

            <div class="divider"></div>
            <div class="panelSub" style="font-weight:1000">Chest</div>
            <button class="btn blue" style="width:100%;margin-top:10px" onclick="switchView('chest')">Open ğŸ Chest</button>

            <div class="divider"></div>
            <div class="panelSub" style="font-weight:1000">Cosmic League</div>
            <button class="btn orange" style="width:100%;margin-top:10px" onclick="switchView('hof')">ğŸŒŸ Hall of Fame</button>
          </section>
        </div>
      </div>

      <!-- BANK -->
      <div class="view" id="view_bank">
        <div class="contentGrid">
          <section class="panel">
            <div class="panelHeader">
              <div>
                <h2 class="panelTitle">Send ğŸ’</h2>
                <div class="panelSub">Transfer to another registered user</div>
              </div>
              <span class="pill orange">ğŸ¦</span>
            </div>

            <div class="row2">
              <div>
                <label>To Username</label>
                <input id="sendTo" placeholder="e.g ItalyCrazyCat">
              </div>
              <div>
                <label>Amount (supports K/M/B)</label>
                <input id="sendAmt" placeholder="e.g 5M / 250K / 5000000">
              </div>
            </div>

            <div style="display:flex;gap:10px;flex-wrap:wrap;margin-top:12px">
              <button class="btn blue" style="width:220px" onclick="sendGems()">Send ğŸ’ Gems</button>
            </div>
            <div class="error" id="sendErr"></div>

            <div class="divider"></div>
            <div class="panelSub" style="font-weight:1000">Receive</div>
            <div class="panelSub">
              Share your username: <b id="recvUser">â€”</b>
            </div>
          </section>

          <section class="panel">
            <div class="panelHeader">
              <div>
                <h2 class="panelTitle">Profile</h2>
                <div class="panelSub">Avatar + account info</div>
              </div>
              <span class="pill blue">ğŸ‘¤</span>
            </div>

            <div class="row2">
              <div>
                <div style="font-weight:1000">Avatar</div>
                <div class="panelSub" style="margin-top:8px">Small image recommended</div>
                <input type="file" id="avatarInput" accept="image/*" />
                <button class="btn gray" style="width:220px;margin-top:10px" onclick="saveAvatar()">Save Avatar</button>
                <div class="panelSub" style="margin-top:8px">Saved on backend</div>
              </div>

              <div>
                <div style="font-weight:1000">Rank Rules</div>
                <div class="panelSub" style="margin-top:10px" id="rankRules">
                  Starter â†’ 0 ğŸ’<br>
                  Grinder â†’ 1M+ ğŸ’<br>
                  Elite â†’ 50M+ ğŸ’<br>
                  Boss â†’ 250M+ ğŸ’<br>
                  Master â†’ 2B+ ğŸ’<br>
                  Cosmic â†’ 20B+ ğŸ’<br>
                  Celestial â†’ 70B+ ğŸ’
                </div>
                <div class="divider"></div>
                <div class="panelSub">More roles can be added later.</div>
              </div>
            </div>

          </section>
        </div>
      </div>

      <!-- REQUESTS -->
      <div class="view" id="view_requests">
        <div class="contentGrid">
          <section class="panel">
            <div class="panelHeader">
              <div>
                <h2 class="panelTitle">Your Requests</h2>
                <div class="panelSub">Deposit / Withdraw</div>
              </div>
              <span class="pill blue">ğŸ“¥</span>
            </div>
            <div class="list" id="myReqList"></div>
            <div class="panelSub" id="myReqEmpty" style="display:none">No requests yet.</div>
          </section>

          <section class="panel">
            <div class="panelHeader">
              <div>
                <h2 class="panelTitle">All Requests</h2>
                <div class="panelSub">Admin sees everything</div>
              </div>
              <span class="pill green">ğŸ›¡ï¸</span>
            </div>
            <div class="list" id="allReqList"></div>
            <div class="panelSub" id="allReqEmpty" style="display:none">No requests yet.</div>
          </section>
        </div>
      </div>

      <!-- LEADERBOARD -->
      <div class="view" id="view_leaderboard">
        <section class="panel">
          <div class="panelHeader">
            <div>
              <h2 class="panelTitle">Leaderboard</h2>
              <div class="panelSub">Top balances â€¢ live</div>
            </div>
            <span class="pill green">ğŸ†</span>
          </div>

          <div class="podium" id="podium"></div>

          <div class="divider"></div>

          <div class="panelSub" style="font-weight:1000">Ranks</div>
          <div class="list" id="lbList"></div>
        </section>
      </div>

      <!-- REDEEM -->
      <div class="view" id="view_redeem">
        <div class="contentGrid">
          <section class="panel">
            <div class="panelHeader">
              <div>
                <h2 class="panelTitle">Redeem Codes</h2>
                <div class="panelSub">Codes are set by admins</div>
              </div>
              <span class="pill orange">ğŸ«</span>
            </div>

            <label>Enter Code</label>
            <input id="redeemCode" placeholder="e.g ORION-BOOST-1">
            <button class="btn blue" style="width:220px;margin-top:12px" onclick="redeem()">Redeem</button>
            <div class="error" id="redeemErr"></div>
            <div class="ok" id="redeemOk"></div>

            <div class="divider"></div>
            <div class="panelSub" style="font-weight:1000">Active Drops</div>
            <div class="list" id="redeemList"></div>
            <div class="panelSub" id="redeemEmpty" style="display:none">No active codes right now.</div>
          </section>

          <section class="panel">
            <div class="panelHeader">
              <div>
                <h2 class="panelTitle">How it works</h2>
                <div class="panelSub">Simple rules</div>
              </div>
              <span class="pill green">âœ…</span>
            </div>
            <div class="panelSub">
              â€¢ Codes can reward ğŸ’ gems or ğŸ¥ tokens.<br>
              â€¢ Some codes are limited to Beta Testers / Early Access.<br>
              â€¢ Some codes expire or have max uses.<br>
            </div>
          </section>
        </div>
      </div>

      <!-- CHEST -->
      <div class="view" id="view_chest">
        <div class="contentGrid">
          <section class="panel">
            <div class="panelHeader">
              <div>
                <h2 class="panelTitle">ğŸ Chest</h2>
                <div class="panelSub">Costs ğŸ¥ tokens â€¢ rewards are RNG</div>
              </div>
              <span class="pill purple">ğŸ¥</span>
            </div>

            <div class="chestHero">
              <div style="display:flex;align-items:center;justify-content:space-between;gap:12px;flex-wrap:wrap">
                <div>
                  <div style="font-weight:1000;font-size:18px">Open a Chest</div>
                  <div class="panelSub" id="chestMeta">Cost: â€”</div>
                  <div class="panelSub" id="chestMaxHint" style="margin-top:6px;font-weight:1000">Max opens right now: â€”</div>
                </div>

                <div style="display:flex;gap:10px;flex-wrap:wrap;justify-content:flex-end">
                  <button class="btn orange" style="min-width:220px" onclick="openChest()">Open Chest ğŸ</button>
                  <button class="btn blue" style="min-width:220px" onclick="openMultiChest()">Open Multiple âœ¨</button>
                </div>
              </div>

              <div class="divider"></div>

              <div class="panelSub" style="font-weight:1000">Possible Rewards</div>
              <div class="list" id="chestRewards"></div>
              <div class="panelSub" id="chestRewardsEmpty" style="display:none">Loading rewardsâ€¦</div>
            </div>

            <div class="divider"></div>

            <div class="panelSub" style="font-weight:1000">ğŸŒ Chest Opens Feed</div>
            <div class="scrollPanel">
              <div class="list" id="chestFeed"></div>
              <div class="panelSub" id="chestFeedEmpty" style="display:none">No chest opens yet.</div>
            </div>
          </section>

          <section class="panel" id="chestAdminBox" style="display:none">
            <div class="panelHeader">
              <div>
                <h2 class="panelTitle">Admin Chest Buffs</h2>
                <div class="panelSub">Only admins can change odds</div>
              </div>
              <span class="pill green">ğŸ›¡ï¸</span>
            </div>

            <div class="row2">
              <div>
                <label>Global multiplier</label>
                <input id="boostMult" placeholder="e.g 1.25">
              </div>
              <div>
                <label>Huge chance bonus (%)</label>
                <input id="boostHuge" placeholder="e.g 0.5">
              </div>
            </div>
            <div class="row2" style="margin-top:10px">
              <div>
                <label>Token bonus</label>
                <input id="boostTok" placeholder="e.g 50">
              </div>
              <div>
                <label>Duration (minutes)</label>
                <input id="boostMins" placeholder="e.g 30">
              </div>
            </div>

            <button class="btn red" style="width:240px;margin-top:12px" onclick="setChestBoost()">Apply Buff ğŸ”¥</button>
            <div class="error" id="boostErr"></div>
            <div class="ok" id="boostOk"></div>

            <div class="divider"></div>
            <div style="font-weight:1000">Pet Conversion Values (Admin)</div>
            <div class="panelSub">Set backend values used by /api/inventory/convert</div>

            <div class="row2" style="margin-top:10px">
              <div>
                <label>Huge â†’ Gems</label>
                <input id="pvHuge" placeholder="e.g 9000000">
              </div>
              <div>
                <label>Titanic â†’ Gems</label>
                <input id="pvTitanic" placeholder="e.g 4400000000">
              </div>
            </div>
            <button class="btn green" style="width:240px;margin-top:12px" onclick="setPetValues()">Update Pet Values âœ…</button>
            <div class="error" id="pvErr"></div>
            <div class="ok" id="pvOk"></div>
          </section>
        </div>
      </div>

<!-- ========= END PART 1 (continue with PART 2) ========= -->
<!-- =========================
PART 2 / 3 â€” bank.html
(Paste this DIRECTLY under Part 1)
========================= -->

      <!-- INVENTORY -->
      <div class="view" id="view_inventory">
        <div class="contentGrid">
          <section class="panel">
            <div class="panelHeader">
              <div>
                <h2 class="panelTitle">ğŸ’ Inventory</h2>
                <div class="panelSub">Pets stored from Chest rewards</div>
              </div>
              <span class="pill blue">INV</span>
            </div>

            <div class="panelSub" style="font-weight:1000">Exchange Rates</div>
            <div class="panelSub" style="margin-top:8px">
              Huge â†’ <b>9,000,000 ğŸ’</b><br>
              Titanic â†’ <b>4,400,000,000 ğŸ’</b>
            </div>

            <div class="divider"></div>

            <div style="display:flex;gap:10px;flex-wrap:wrap">
              <button class="btn blue" style="width:220px" onclick="refreshInventory(true)">Refresh Inventory</button>
              <button class="btn purple" style="width:260px" onclick="switchView('chest')">Go ğŸ Chest</button>

              <!-- âœ… NEW: Convert inventory -->
              <button class="btn green" style="width:260px" onclick="openInvConvert()">ğŸ’ Convert Pets â†’ Gems</button>
            </div>

            <div class="divider"></div>

            <div class="panelSub" style="font-weight:1000">Your Pets</div>
            <div class="list" id="invList"></div>
            <div class="panelSub" id="invEmpty" style="display:none;margin-top:8px">No pets in inventory.</div>
          </section>

          <section class="panel">
            <div class="panelHeader">
              <div>
                <h2 class="panelTitle">How it works</h2>
                <div class="panelSub">Grouped view</div>
              </div>
              <span class="pill green">âœ…</span>
            </div>

            <div class="panelSub">
              â€¢ Pets appear here when Chest gives <b>Huge</b> or <b>Titanic</b>.<br>
              â€¢ Inventory groups pets: e.g. <b>Huge</b> x253.<br>
              â€¢ Convert turns stored pets into ğŸ’ using backend conversion values.<br>
            </div>

            <div class="divider"></div>
            <div class="panelSub" style="font-weight:1000">Status meanings</div>
            <div class="panelSub">
              â€¢ <b>stored</b> = waiting<br>
              â€¢ <b>claimed</b> = claimed (not convertible)<br>
              â€¢ <b>converted</b> = converted to gems (done)<br>
            </div>
          </section>
        </div>
      </div>

      <!-- EVENTS -->
      <div class="view" id="view_events">
        <section class="panel">
          <div class="panelHeader">
            <div>
              <h2 class="panelTitle">âš¡ Events</h2>
              <div class="panelSub">Controlled by admins â€¢ live broadcast</div>
            </div>
            <span class="pill orange">LIVE</span>
          </div>

          <div id="eventsComing" class="bigSoon">âš« COMING SOON</div>

          <div id="eventsLive" style="display:none">
            <div class="eventBar">
              <div class="eventA" id="eventAvatar"></div>
              <div class="eventT">
                <div class="eventTop" id="eventTop">ADMIN MESSAGE</div>
                <div class="eventText" id="eventText">â€”</div>
                <div class="eventTime" id="eventTime">â€”</div>
              </div>
            </div>

            <div class="divider"></div>
            <div class="panelSub">
              If a game round is not active, you will only see COMING SOON.
            </div>
          </div>
        </section>
      </div>

      <!-- BLOGS -->
      <div class="view" id="view_blogs">
        <div class="contentGrid">
          <section class="panel">
            <div class="panelHeader">
              <div>
                <h2 class="panelTitle">ğŸ“° Blogs</h2>
                <div class="panelSub">3 per row â€¢ click to read</div>
              </div>
              <span class="pill blue">NEWS</span>
            </div>

            <div class="grid3" id="blogGrid"></div>
            <div class="panelSub" id="blogEmpty" style="display:none">No posts yet.</div>
          </section>

          <section class="panel">
            <div class="panelHeader">
              <div>
                <h2 class="panelTitle">Post Viewer</h2>
                <div class="panelSub">Read + comments</div>
              </div>
              <span class="pill orange">ğŸ“Œ</span>
            </div>

            <div id="postViewer" class="panelSub">Click a post to view.</div>

            <div class="divider"></div>

            <div style="font-weight:1000">Comments</div>
            <div class="list" id="commentList"></div>
            <div class="panelSub" id="commentEmpty" style="display:none">No comments yet.</div>

            <div class="divider"></div>

            <label>Add comment</label>
            <textarea id="commentText" placeholder="Type your comment..."></textarea>
            <button class="btn green" style="width:220px;margin-top:10px" onclick="postComment()">Send Comment</button>
            <div class="error" id="commentErr"></div>
          </section>
        </div>
      </div>

      <!-- âœ… NEW: HALL OF FAME -->
      <div class="view" id="view_hof">
        <div class="contentGrid">
          <section class="panel">
            <div class="panelHeader">
              <div>
                <h2 class="panelTitle">ğŸŒŸ Cosmic League Hall of Fame</h2>
                <div class="panelSub">5 devs â€¢ managed by Admin</div>
              </div>
              <span class="pill orange">C.L.</span>
            </div>

            <div class="panelSub" style="font-weight:1000">Dev Frames</div>
            <div class="panelSub">Admins can update image + name for each slot.</div>

            <div class="hofWrap" id="hofGrid">
              <!-- filled by JS -->
            </div>

            <div class="divider"></div>

            <div class="panelSub" style="font-weight:1000">Roblox Deposit Account</div>
            <div class="panelSub">Send your gems to this account for deposits (as instructed by staff).</div>

            <div class="depositBox" style="margin-top:10px">
              <div class="depA" id="depAvatar">ğŸ’</div>
              <div class="depT">
                <div class="depTitle">Deposit Receiver</div>
                <div class="depUser" id="depUser">@â€”</div>
                <div class="depNote" id="depNote">â€”</div>
              </div>
            </div>
          </section>

          <section class="panel">
            <div class="panelHeader">
              <div>
                <h2 class="panelTitle">How it works</h2>
                <div class="panelSub">Simple & clean</div>
              </div>
              <span class="pill green">âœ…</span>
            </div>

            <div class="panelSub">
              â€¢ The Hall of Fame is **cosmetic** (images + titles).<br>
              â€¢ Admins upload images (saved on backend) and set the names.<br>
              â€¢ Deposit receiver box shows where users must send Roblox gems for deposits.<br>
            </div>

            <div class="divider"></div>

            <div class="panelSub" style="font-weight:1000">Safety Tip</div>
            <div class="panelSub">
              Always confirm the deposit receiver username in Discord before sending gems.
            </div>
          </section>
        </div>
      </div>

      <!-- ADMIN -->
      <div class="view" id="view_admin">
        <div class="contentGrid">
          <section class="panel">
            <div class="panelHeader">
              <div>
                <h2 class="panelTitle">Admin Tools</h2>
                <div class="panelSub">Super Admin can wipe</div>
              </div>
              <span class="pill green">ğŸ›¡ï¸</span>
            </div>

            <div class="row2">
              <div>
                <label>Interest Rate (%)</label>
                <input id="interestRate" placeholder="e.g 1.5">
                <button class="btn blue" style="width:220px;margin-top:10px" onclick="setInterest()">Update Interest</button>
                <div class="error" id="interestErr"></div>
                <div class="ok" id="interestOk"></div>
              </div>
              <div>
                <label>Registered Users</label>
                <div class="panelSub">List is live</div>
                <div class="list" id="userList"></div>
              </div>
            </div>

            <div class="divider"></div>

            <div class="row2">
              <div>
                <div style="font-weight:1000">Adjust Member Balance</div>
                <div class="panelSub">Admins only</div>
                <label>Username</label>
                <input id="adjUser" placeholder="e.g someone">
                <label>Amount</label>
                <input id="adjAmt" placeholder="e.g 1000000">
                <div style="display:flex;gap:10px;flex-wrap:wrap;margin-top:10px">
                  <button class="btn green" onclick="adminAdjust(+1)">Increase</button>
                  <button class="btn red" onclick="adminAdjust(-1)">Decrease</button>
                </div>
                <div class="error" id="adjErr"></div>
                <div class="ok" id="adjOk"></div>
              </div>

              <div>
                <div style="font-weight:1000">Roles</div>
                <div class="panelSub">Assign Beta Tester / Early Access</div>
                <label>Username</label>
                <input id="roleUser" placeholder="e.g someone">
                <label>Role</label>
                <select id="rolePick">
                  <option value="beta">Beta Tester</option>
                  <option value="early">Early Access</option>
                </select>
                <button class="btn purple" style="width:220px;margin-top:10px" onclick="setRole()">Assign Role</button>
                <div class="error" id="roleErr"></div>
                <div class="ok" id="roleOk"></div>

                <div class="divider"></div>
                <div style="font-weight:1000">Danger Zone (Super Admin only)</div>
                <div class="panelSub">Wipes users/balances/posts/requests</div>
                <button class="btn red" style="width:260px;margin-top:10px" onclick="wipeAll()">WIPE EVERYTHING</button>
                <div class="error" id="wipeErr"></div>
                <div class="ok" id="wipeOk"></div>
              </div>
            </div>
          </section>

          <section class="panel">
            <div class="panelHeader">
              <div>
                <h2 class="panelTitle">Admin Blog Controls</h2>
                <div class="panelSub">Delete posts</div>
              </div>
              <span class="pill orange">ğŸ“°</span>
            </div>

            <div class="panelSub">Select a post in Blogs tab, then delete here.</div>
            <button class="btn red" style="width:220px;margin-top:12px" onclick="deletePost()">Delete Selected Post</button>
            <div class="error" id="delPostErr"></div>
            <div class="ok" id="delPostOk"></div>

            <div class="divider"></div>
            <div class="panelSub" style="font-weight:1000">Admin Redeem Code Drop</div>

            <label>Code</label>
            <input id="newCode" placeholder="e.g ORION-500TOK">
            <div class="row2">
              <div>
                <label>Reward Type</label>
                <select id="newCodeType">
                  <option value="tokens">ğŸ¥ Tokens</option>
                  <option value="gems">ğŸ’ Gems</option>
                </select>
              </div>
              <div>
                <label>Amount</label>
                <input id="newCodeAmt" placeholder="e.g 500">
              </div>
            </div>
            <div class="row2" style="margin-top:10px">
              <div>
                <label>Max uses (optional)</label>
                <input id="newCodeMax" placeholder="e.g 50">
              </div>
              <div>
                <label>Expires (minutes, optional)</label>
                <input id="newCodeExp" placeholder="e.g 60">
              </div>
            </div>

            <div class="row2" style="margin-top:10px">
              <div>
                <label>Limit to role (optional)</label>
                <select id="newCodeRole">
                  <option value="">None</option>
                  <option value="beta">Beta Tester</option>
                  <option value="early">Early Access</option>
                </select>
              </div>
              <div style="display:flex;align-items:flex-end">
                <button class="btn green" style="width:100%" onclick="createCode()">Create Code</button>
              </div>
            </div>

            <div class="error" id="codeErr"></div>
            <div class="ok" id="codeOk"></div>

            <!-- âœ… NEW: Hall of Fame Admin Controls -->
            <div class="divider"></div>
            <div style="font-weight:1000">ğŸŒŸ Hall of Fame Admin</div>
            <div class="panelSub">Update the 5 dev slots + deposit receiver box.</div>

            <div class="row2" style="margin-top:10px">
              <div>
                <label>Slot (1-5)</label>
                <input id="hofSlot" type="number" min="1" max="5" placeholder="e.g 1">
              </div>
              <div>
                <label>Dev Name/Title</label>
                <input id="hofName" placeholder="e.g Trinity âœ¨ (Lead Dev)">
              </div>
            </div>

            <label style="margin-top:10px;display:block">Dev Image</label>
            <input type="file" id="hofImg" accept="image/*" />
            <button class="btn blue" style="width:240px;margin-top:10px" onclick="adminUpdateHOF()">Update Dev Slot âœ…</button>
            <div class="error" id="hofErr"></div>
            <div class="ok" id="hofOk"></div>

            <div class="divider"></div>
            <div style="font-weight:1000">ğŸ’ Deposit Receiver Settings</div>

            <div class="row2" style="margin-top:10px">
              <div>
                <label>Roblox Username</label>
                <input id="depSetUser" placeholder="e.g JuniorCosmicLeague">
              </div>
              <div>
                <label>Short Note</label>
                <input id="depSetNote" placeholder="e.g Send gems + include your Orion username">
              </div>
            </div>

            <label style="margin-top:10px;display:block">Receiver Image</label>
            <input type="file" id="depSetImg" accept="image/*" />
            <button class="btn green" style="width:240px;margin-top:10px" onclick="adminUpdateDepositBox()">Save Deposit Box âœ…</button>
            <div class="error" id="depSetErr"></div>
            <div class="ok" id="depSetOk"></div>

          </section>
        </div>
      </div>

    </main>
  </div>

  <!-- AUTH MODAL -->
  <div class="modal" id="authModal">
    <div class="modalBox">
      <button class="closeX" onclick="closeAuth()">âœ•</button>
      <div class="modalTitle" id="authTitle">Login</div>
      <div class="modalSub" id="authSub">Sign in to access your balance and profile.</div>

      <div class="row2">
        <div>
          <label>Username</label>
          <input id="authUser" placeholder="e.g Username">
        </div>
        <div>
          <label>Password</label>
          <input id="authPass" type="password" placeholder="your password">
        </div>
      </div>

      <div class="error" id="authErr"></div>

      <div style="display:flex;gap:10px;justify-content:center;margin-top:12px">
        <button class="btn gray" style="width:160px" onclick="closeAuth()">Cancel</button>
        <button class="btn orange" style="width:160px" id="authActionBtn" onclick="login()">Login</button>
      </div>
    </div>
  </div>

  <!-- REQUEST MODAL -->
  <div class="modal" id="reqModal">
    <div class="modalBox">
      <button class="closeX" onclick="closeReq()">âœ•</button>
      <div class="modalTitle" id="reqTitle">Request</div>
      <div class="modalSub">Creates a pending request</div>

      <label>Amount</label>
      <input id="reqAmt" placeholder="e.g 5M / 250K / 5000000">
      <div class="error" id="reqErr"></div>

      <div style="display:flex;gap:10px;justify-content:center;margin-top:12px">
        <button class="btn gray" style="width:160px" onclick="closeReq()">Cancel</button>
        <button class="btn green" style="width:160px" onclick="submitReq()">Submit</button>
      </div>
    </div>
  </div>

  <!-- CONVERT MODAL -->
  <div class="modal" id="convModal">
    <div class="modalBox">
      <button class="closeX" onclick="closeConvert()">âœ•</button>
      <div class="modalTitle">ğŸ¥ Convert Gems â†’ Tokens</div>
      <div class="modalSub">Rate: 8,000,000 ğŸ’ = 500 ğŸ¥ â€¢ 500-step only</div>

      <label>Gems to convert</label>
      <input id="convAmt" placeholder="e.g 8000000 / 16M / 24M">

      <div class="panelSub" style="margin-top:10px" id="convPreview">You will receive: â€”</div>
      <div class="error" id="convErr"></div>
      <div class="ok" id="convOk"></div>

      <div style="display:flex;gap:10px;justify-content:center;margin-top:12px">
        <button class="btn gray" style="width:160px" onclick="closeConvert()">Cancel</button>
        <button class="btn purple" style="width:160px" onclick="convert()">Convert</button>
      </div>
    </div>
  </div>

  <!-- MULTI CHEST MODAL -->
  <div class="modal" id="multiModal">
    <div class="modalBox">
      <button class="closeX" onclick="closeMulti()">âœ•</button>
      <div class="modalTitle">Open Multiple Chests âœ¨</div>
      <div class="modalSub" id="multiSub">Select how many to open</div>

      <label>How many?</label>
      <input id="multiCount" type="number" min="1" step="1" placeholder="Max: â€”">
      <div class="panelSub" style="margin-top:10px" id="multiPreview">Cost: â€”</div>
      <div class="error" id="multiErr"></div>
      <div class="ok" id="multiOk"></div>

      <div style="display:flex;gap:10px;justify-content:center;margin-top:12px">
        <button class="btn gray" style="width:160px" onclick="closeMulti()">Cancel</button>
        <button class="btn blue" style="width:160px" id="multiGoBtn" onclick="runMulti()">Open</button>
      </div>
    </div>
  </div>

  <!-- SERVER ANNOUNCEMENT MODAL -->
  <div class="modal" id="announceModal">
    <div class="modalBox" style="max-width:640px;border:3px solid rgba(255,159,28,.55)">
      <button class="closeX" onclick="closeAnnounce()">âœ•</button>
      <div class="modalTitle" id="announceTitle">ğŸš¨ SERVER ANNOUNCEMENT</div>
      <div class="modalSub" id="announceSub">â€”</div>

      <div style="margin-top:12px;padding:14px;border-radius:18px;background:linear-gradient(135deg, rgba(255,159,28,.18), rgba(132,94,247,.16));border:1px solid rgba(0,0,0,.10)">
        <div style="font-weight:1000;font-size:18px" id="announceBig">â€”</div>
        <div class="panelSub" style="margin-top:6px" id="announceTime">â€”</div>
      </div>

      <div style="display:flex;justify-content:center;margin-top:14px">
        <button class="btn orange" style="width:220px" onclick="closeAnnounce()">OK âœ…</button>
      </div>
    </div>
  </div>

  <!-- âœ… NEW: INVENTORY CONVERT MODAL -->
  <div class="modal" id="invConvModal">
    <div class="modalBox">
      <button class="closeX" onclick="closeInvConvert()">âœ•</button>
      <div class="modalTitle">ğŸ’ Convert Pets â†’ Gems</div>
      <div class="modalSub">Convert stored Huge/Titanic into gems (backend values)</div>

      <div class="row2">
        <div>
          <label>Type</label>
          <select id="invConvType">
            <option value="huge">Huge</option>
            <option value="titanic">Titanic</option>
          </select>
        </div>
        <div>
          <label>Amount to convert</label>
          <input id="invConvCount" type="number" min="1" step="1" placeholder="e.g 10">
        </div>
      </div>

      <div class="panelSub" style="margin-top:10px" id="invConvPreview">You will receive: â€”</div>
      <div class="error" id="invConvErr"></div>
      <div class="ok" id="invConvOk"></div>

      <div style="display:flex;gap:10px;justify-content:center;margin-top:12px">
        <button class="btn gray" style="width:160px" onclick="closeInvConvert()">Cancel</button>
        <button class="btn green" style="width:160px" onclick="doInvConvert()">Convert</button>
      </div>
    </div>
  </div>

<!-- ========= END PART 2 (continue with PART 3: JS) ========= -->
<!-- =========================
PART 3 / 3 â€” bank.html
(Paste this DIRECTLY under Part 2)
Includes: Hall of Fame styles + JS + closing tags
========================= -->

<style>
  /* âœ… Hall of Fame */
  .hofWrap{
    margin-top:12px;
    display:grid;
    grid-template-columns: 1fr 1fr 1fr 1fr 1fr;
    gap:12px;
  }
  .hofCard{
    background:#fff;
    border:1px solid rgba(0,0,0,.10);
    border-radius:22px;
    box-shadow:var(--shadow2);
    padding:12px;
    text-align:center;
    overflow:hidden;
  }
  .hofCircle{
    width:92px;height:92px;border-radius:999px;
    margin:0 auto 10px;
    background:#e9e9e9;
    border:3px solid rgba(255,159,28,.55);
    overflow:hidden;
    box-shadow:0 12px 24px rgba(0,0,0,.10);
    display:flex;align-items:center;justify-content:center;
    font-size:26px;font-weight:1000;color:#444;
  }
  .hofCircle img{width:100%;height:100%;object-fit:cover;display:block}
  .hofName{
    font-weight:1000;
    font-size:13px;
    white-space:nowrap;
    overflow:hidden;
    text-overflow:ellipsis;
  }
  .hofTag{
    display:inline-flex;
    margin-top:8px;
  }

  /* âœ… Deposit receiver box */
  .depositBox{
    display:flex;
    align-items:center;
    gap:12px;
    background:#fff;
    border:1px solid rgba(0,0,0,.10);
    border-radius:22px;
    box-shadow:var(--shadow2);
    padding:12px;
  }
  .depA{
    width:54px;height:54px;border-radius:18px;
    background:#e9e9e9;
    overflow:hidden;
    border:2px solid rgba(0,0,0,.10);
    display:flex;align-items:center;justify-content:center;
    font-size:22px;font-weight:1000;
  }
  .depA img{width:100%;height:100%;object-fit:cover;display:block}
  .depT{flex:1;min-width:0}
  .depTitle{font-weight:1000}
  .depUser{margin-top:6px;font-weight:1000}
  .depNote{margin-top:6px;color:var(--muted);font-weight:900;font-size:12px}

  @media (max-width: 1200px){
    .hofWrap{grid-template-columns: 1fr 1fr 1fr;}
  }
  @media (max-width: 820px){
    .hofWrap{grid-template-columns: 1fr 1fr;}
  }
  </style>
<script>
  // =========================
  // CONFIG
  // =========================
  const API_BASE = "https://4e74ae9e-afad-4327-981d-85a4a2d2c6bd-00-1v9sw5mrqqnf3.riker.replit.dev"; // <- jrchesskid change this
  const TOKEN_KEY = "orion_token_v1";

  // Convert rule (matches backend)
  const CONV_GEMS_CHUNK = 8000000; // 8,000,000 gems
  const CONV_TOKENS_STEP = 500;    // 500 tokens per chunk

  // âœ… UI exchange defaults (backend can override)
  const UI_HUGE_TO_GEMS = 9000000;        // 9M
  const UI_TITANIC_TO_GEMS = 4400000000;  // 4.4B

  // Titanic announcement fingerprint
  const LAST_ANNOUNCE_KEY = "orion_last_announce_v1";

  // =========================
  // STATE
  // =========================
  let sessionUser = null;
  let isAdmin = false;
  let adminLevel = "none";

  let db = {
    requests: [],
    tx: [],
    leaderboard: [],
    posts: [],
    selectedPostId: "",
    redeem: [],
    chest: { costTokens: 500, rewards: [], boosts: null, petValues: null },
    eventsState: { mode:"coming_soon" },
    usersMini: [],
    inventoryPets: [],
    chestFeed: [],
    hof: {
      slots: [
        { name:"Dev #1", image:"" },
        { name:"Dev #2", image:"" },
        { name:"Dev #3", image:"" },
        { name:"Dev #4", image:"" },
        { name:"Dev #5", image:"" },
      ],
      depositBox: { username:"â€”", note:"â€”", image:"" }
    }
  };

  let view = "dash";
  let pendingType = "deposit";
  let pollTimer = null;

  // âœ… FIXED LOCKS:
  let lock = {
    me:false, state:false, lb:false, posts:false, events:false, redeem:false,
    chest:false, users:false, inv:false, hof:false
  };

  const $ = (id)=>document.getElementById(id);

  // =========================
  // HELPERS
  // =========================
  function norm(s){ return (s||"").trim(); }
  function fmt(n){ return (Number(n)||0).toLocaleString("en-US"); }

  function parseAmount(val){
    val = (val||"").toUpperCase().trim().replace(/,/g,"");
    if(!val) return NaN;
    if(val.endsWith("K")) return Math.floor(parseFloat(val.slice(0,-1))*1000);
    if(val.endsWith("M")) return Math.floor(parseFloat(val.slice(0,-1))*1000000);
    if(val.endsWith("B")) return Math.floor(parseFloat(val.slice(0,-1))*1000000000);
    const n = Number(val);
    return Number.isFinite(n) ? Math.floor(n) : NaN;
  }

  function roleFromBalance(b){
    b = Number(b)||0;
    if(b >= 70000000000) return "Celestial";
    if(b >= 20000000000) return "Cosmic";
    if(b >= 2000000000)  return "Master";
    if(b >= 250000000)   return "Boss";
    if(b >= 50000000)    return "Elite";
    if(b >= 1000000)     return "Grinder";
    return "Starter";
  }

  function rolePillClass(role){
    if(role === "Celestial") return "pill purple";
    if(role === "Cosmic") return "pill green";
    if(role === "Master") return "pill green";
    if(role === "Boss") return "pill orange";
    if(role === "Elite") return "pill blue";
    if(role === "Grinder") return "pill blue";
    return "pill orange";
  }

  function timeAgo(ts){
    const mins = Math.floor((Date.now()-ts)/60000);
    if(mins < 1) return "Just now";
    if(mins < 60) return mins + " min ago";
    const hrs = Math.floor(mins/60);
    if(hrs < 24) return hrs + "h ago";
    const d = Math.floor(hrs/24);
    return d + "d ago";
  }

  function escapeHtml(s){
    return String(s||"")
      .replaceAll("&","&amp;")
      .replaceAll("<","&lt;")
      .replaceAll(">","&gt;")
      .replaceAll('"',"&quot;")
      .replaceAll("'","&#039;");
  }

  // =========================
  // TOKEN
  // =========================
  function getToken(){ return localStorage.getItem(TOKEN_KEY) || ""; }
  function setToken(t){ localStorage.setItem(TOKEN_KEY, t); }
  function clearToken(){ localStorage.removeItem(TOKEN_KEY); }

  // =========================
  // API
  // =========================
  async function api(path, opts={}){
    const headers = Object.assign({ "Content-Type":"application/json" }, opts.headers||{});
    const t = getToken();
    if(t) headers.Authorization = "Bearer " + t;

    const res = await fetch(API_BASE + path, { ...opts, headers });
    const data = await res.json().catch(()=>({}));
    if(!res.ok) throw new Error(data.error || "Request failed");
    return data;
  }

  async function ping(){
    try{
      const r = await fetch(API_BASE + "/api/health");
      if(!r.ok) throw 0;
      if($("apiStatus")) $("apiStatus").textContent = "API: Online âœ…";
    }catch{
      if($("apiStatus")) $("apiStatus").textContent = "API: Offline âŒ";
    }
  }

  // =========================
  // NAV / VIEWS (âœ… includes hof)
  // =========================
  function switchView(v){
    view = v;
    const all = ["dash","bank","requests","leaderboard","redeem","chest","inventory","events","blogs","hof","admin"];
    all.forEach(x=>{
      const vv = $("view_"+x);
      const nn = $("nav_"+x);
      if(vv) vv.classList.remove("show");
      if(nn) nn.classList.remove("active");
    });
    if($("view_"+v)) $("view_"+v).classList.add("show");
    if($("nav_"+v)) $("nav_"+v).classList.add("active");
    renderAll();
  }

  // =========================
  // AUTH
  // =========================
  function openAuth(registerMode=false){
    if($("authErr")) $("authErr").textContent = "";
    if($("authUser")) $("authUser").value = "";
    if($("authPass")) $("authPass").value = "";
    if($("authTitle")) $("authTitle").textContent = registerMode ? "Register" : "Login";
    if($("authSub")) $("authSub").textContent = registerMode
      ? "Create your account. Balance starts at 0 ğŸ’."
      : "Sign in to access your balance and profile.";
    if($("authActionBtn")){
      $("authActionBtn").textContent = registerMode ? "Register" : "Login";
      $("authActionBtn").onclick = registerMode ? register : login;
    }
    if($("authModal")) $("authModal").style.display = "flex";
  }
  function closeAuth(){ if($("authModal")) $("authModal").style.display = "none"; }

  async function register(){
    const u = norm($("authUser")?.value);
    const p = $("authPass")?.value || "";
    if($("authErr")) $("authErr").textContent = "";
    if(!u || !p){ if($("authErr")) $("authErr").textContent = "Enter username + password."; return; }
    try{
      await api("/api/register", { method:"POST", body: JSON.stringify({ username:u, password:p }) });
      const loginRes = await api("/api/login", { method:"POST", body: JSON.stringify({ username:u, password:p }) });
      setToken(loginRes.token);
      closeAuth();
      await refreshAll(true);
    }catch(err){
      if($("authErr")) $("authErr").textContent = err.message;
    }
  }

  async function login(){
    const u = norm($("authUser")?.value);
    const p = $("authPass")?.value || "";
    if($("authErr")) $("authErr").textContent = "";
    if(!u || !p){ if($("authErr")) $("authErr").textContent = "Enter username + password."; return; }
    try{
      const loginRes = await api("/api/login", { method:"POST", body: JSON.stringify({ username:u, password:p }) });
      setToken(loginRes.token);
      closeAuth();
      await refreshAll(true);
    }catch(err){
      if($("authErr")) $("authErr").textContent = err.message;
    }
  }

  async function logout(){
    try{ await api("/api/logout", { method:"POST" }); }catch{}
    clearToken();
    sessionUser = null;
    isAdmin = false;
    adminLevel = "none";
    db = {
      requests:[], tx:[], leaderboard:[], posts:[], selectedPostId:"",
      redeem:[], chest:{costTokens:500,rewards:[],boosts:null,petValues:null},
      eventsState:{mode:"coming_soon"}, usersMini:[], inventoryPets:[], chestFeed:[],
      hof: db.hof
    };
    renderAll();
    switchView("dash");
  }

  // =========================
  // REQUESTS
  // =========================
  function openReq(type){
    pendingType = type;
    if($("reqTitle")) $("reqTitle").textContent = (type === "deposit" ? "Deposit Request" : "Withdraw Request");
    if($("reqAmt")) $("reqAmt").value = "";
    if($("reqErr")) $("reqErr").textContent = "";
    if($("reqModal")) $("reqModal").style.display = "flex";
  }
  function closeReq(){ if($("reqModal")) $("reqModal").style.display = "none"; }

  async function submitReq(){
    if($("reqErr")) $("reqErr").textContent = "";
    if(!sessionUser){ if($("reqErr")) $("reqErr").textContent = "Register/Login first."; return; }
    const amt = parseAmount($("reqAmt")?.value);
    if(!Number.isFinite(amt) || amt <= 0){ if($("reqErr")) $("reqErr").textContent = "Invalid amount."; return; }
    try{
      await api("/api/request", { method:"POST", body: JSON.stringify({ type: pendingType, amount: amt }) });
      closeReq();
      await refreshAll();
    }catch(err){
      if($("reqErr")) $("reqErr").textContent = err.message;
    }
  }

  // =========================
  // âœ… ADMIN APPROVE / DECLINE
  // =========================
  async function approveReq(id){
    if(!isAdmin) return alert("Admin only.");
    try{
      await api("/api/admin/request/" + encodeURIComponent(id) + "/approve", { method:"POST" });
      await refreshAll(true);
    }catch(e){
      alert(e.message || "Approve failed");
    }
  }

  async function declineReq(id){
    if(!isAdmin) return alert("Admin only.");
    try{
      await api("/api/admin/request/" + encodeURIComponent(id) + "/decline", { method:"POST" });
      await refreshAll(true);
    }catch(e){
      alert(e.message || "Decline failed");
    }
  }

  // âœ… alias because your HTML uses denyReq()
  async function denyReq(id){ return declineReq(id); }

  // =========================
  // SEND
  // =========================
  async function sendGems(){
    if($("sendErr")) $("sendErr").textContent = "";
    if(!sessionUser){ if($("sendErr")) $("sendErr").textContent = "Register/Login first."; return; }
    const to = norm($("sendTo")?.value);
    const amt = parseAmount($("sendAmt")?.value);
    if(!to){ if($("sendErr")) $("sendErr").textContent = "Enter a recipient username."; return; }
    if(!Number.isFinite(amt) || amt <= 0){ if($("sendErr")) $("sendErr").textContent = "Invalid amount."; return; }
    try{
      await api("/api/send", { method:"POST", body: JSON.stringify({ to, amount: amt }) });
      if($("sendTo")) $("sendTo").value = "";
      if($("sendAmt")) $("sendAmt").value = "";
      await refreshAll();
    }catch(err){
      if($("sendErr")) $("sendErr").textContent = err.message;
    }
  }

  // =========================
  // AVATAR
  // =========================
  async function saveAvatar(){
    if(!sessionUser){ alert("Register/Login first."); return; }
    const file = $("avatarInput")?.files?.[0];
    if(!file){ alert("Choose an image first."); return; }
    if(file.size > 2_000_000){ alert("Image too big. Under ~2MB."); return; }

    const reader = new FileReader();
    reader.onload = async () => {
      try{
        await api("/api/avatar", { method:"POST", body: JSON.stringify({ avatarDataUrl: reader.result }) });
        await refreshAll();
        alert("Avatar saved.");
      }catch(err){
        alert(err.message);
      }
    };
    reader.readAsDataURL(file);
  }

  // =========================
  // CONVERT (gems -> tokens)
  // =========================
  function openConvert(){
    if($("convAmt")) $("convAmt").value = "";
    if($("convErr")) $("convErr").textContent = "";
    if($("convOk")) $("convOk").textContent = "";
    if($("convPreview")) $("convPreview").textContent = "You will receive: â€”";
    if($("convModal")) $("convModal").style.display = "flex";

    if($("convAmt")){
      $("convAmt").oninput = () => {
        const g = parseAmount($("convAmt").value);
        if(!Number.isFinite(g) || g<=0){
          if($("convPreview")) $("convPreview").textContent = "You will receive: â€”";
          return;
        }
        const chunks = Math.floor(g / CONV_GEMS_CHUNK);
        if(chunks <= 0){
          if($("convPreview")) $("convPreview").textContent = `Minimum: ${fmt(CONV_GEMS_CHUNK)} ğŸ’ â†’ ${fmt(CONV_TOKENS_STEP)} ğŸ¥`;
          return;
        }
        const gemsUsed = chunks * CONV_GEMS_CHUNK;
        const tokensGet = chunks * CONV_TOKENS_STEP;
        if($("convPreview")) $("convPreview").textContent = `You will receive: ${fmt(tokensGet)} ğŸ¥ (uses ${fmt(gemsUsed)} ğŸ’)`;
      };
    }
  }
  function closeConvert(){ if($("convModal")) $("convModal").style.display = "none"; }

  async function convert(){
    if($("convErr")) $("convErr").textContent = "";
    if($("convOk")) $("convOk").textContent = "";
    if(!sessionUser){ if($("convErr")) $("convErr").textContent = "Login first."; return; }

    const g = parseAmount($("convAmt")?.value);
    if(!Number.isFinite(g) || g<=0){ if($("convErr")) $("convErr").textContent = "Invalid amount."; return; }

    if(g % CONV_GEMS_CHUNK !== 0){
      if($("convErr")) $("convErr").textContent = `Gems must be multiples of ${fmt(CONV_GEMS_CHUNK)} (8M).`;
      return;
    }

    try{
      await api("/api/convert", { method:"POST", body: JSON.stringify({ gems: g }) });
      if($("convOk")) $("convOk").textContent = "Converted successfully âœ…";
      await refreshAll();
    }catch(e){
      if($("convErr")) $("convErr").textContent = e.message;
    }
  }

  // =========================
  // REDEEM
  // =========================
  async function redeem(){
    if($("redeemErr")) $("redeemErr").textContent = "";
    if($("redeemOk")) $("redeemOk").textContent = "";
    if(!sessionUser){ if($("redeemErr")) $("redeemErr").textContent = "Login first."; return; }
    const code = norm($("redeemCode")?.value);
    if(!code){ if($("redeemErr")) $("redeemErr").textContent = "Enter a code."; return; }

    try{
      await api("/api/redeem", { method:"POST", body: JSON.stringify({ code }) });
      if($("redeemOk")) $("redeemOk").textContent = "Redeemed âœ…";
      if($("redeemCode")) $("redeemCode").value = "";
      await refreshAll();
    }catch(e){
      if($("redeemErr")) $("redeemErr").textContent = e.message;
    }
  }

  // =========================
  // CHEST
  // =========================
  function maxOpensNow(){
    const cost = Number(db.chest?.costTokens ?? 500);
    const tok = Number(sessionUser?.tokens ?? 0);
    if(cost <= 0) return 0;
    return Math.max(0, Math.floor(tok / cost));
  }

  async function openChest(){
    if(!sessionUser){ alert("Login first."); return; }
    try{
      await api("/api/chest/open", { method:"POST" });
      await refreshAll();
      alert("Chest opened âœ…");
    }catch(e){
      alert(e.message);
    }
  }

  function openMultiChest(){
    if(!sessionUser){ alert("Login first."); return; }
    const cost = Number(db.chest?.costTokens ?? 500);
    const maxN = maxOpensNow();

    if($("multiErr")) $("multiErr").textContent = "";
    if($("multiOk")) $("multiOk").textContent = "";
    if($("multiCount")) $("multiCount").value = "";
    if($("multiCount")){
      $("multiCount").min = "1";
      $("multiCount").max = String(Math.max(1, maxN));
      $("multiCount").placeholder = "Max: " + maxN;
    }
    if($("multiSub")) $("multiSub").textContent = `Cost per chest: ${fmt(cost)} ğŸ¥ â€¢ You can open up to ${maxN}`;
    if($("multiPreview")) $("multiPreview").textContent = `Total cost: â€”`;

    if($("multiCount")){
      $("multiCount").oninput = () => {
        const n = Math.floor(Number($("multiCount").value || 0));
        if(!Number.isFinite(n) || n <= 0){
          if($("multiPreview")) $("multiPreview").textContent = "Total cost: â€”";
          return;
        }
        const clamped = Math.min(n, maxN);
        if(n !== clamped) $("multiCount").value = String(clamped);
        if($("multiPreview")) $("multiPreview").textContent = `Total cost: ${fmt(clamped * cost)} ğŸ¥`;
      };
    }

    if($("multiModal")) $("multiModal").style.display = "flex";
  }
  function closeMulti(){ if($("multiModal")) $("multiModal").style.display = "none"; }

  function rewardLabel(x){
    if(!x) return "ğŸ Reward";
    const t = String(x.type || "").toLowerCase();
    if(t === "titanic") return "ğŸ›¸ğŸ‘‘ Titanic";
    if(t === "huge") return "ğŸ”¥ğŸ Huge";
    if(t === "gems") return `ğŸ’ ${fmt(x.amount || 0)} Gems`;
    if(t === "tokens") return `ğŸ¥ ${fmt(x.amount || 0)} Tokens`;
    const icon = x.icon || "ğŸ";
    const name = x.name || x.type || "Reward";
    return `${icon} ${name}`;
  }

  async function runMulti(){
    if($("multiErr")) $("multiErr").textContent = "";
    if($("multiOk")) $("multiOk").textContent = "";

    const maxN = maxOpensNow();
    const nRaw = Math.floor(Number($("multiCount")?.value || 0));
    const n = Math.min(nRaw, maxN);

    if(!Number.isFinite(nRaw) || nRaw <= 0){
      if($("multiErr")) $("multiErr").textContent = "Enter a valid number.";
      return;
    }
    if(n <= 0){
      if($("multiErr")) $("multiErr").textContent = "Not enough tokens to open any chests.";
      return;
    }

    if($("multiGoBtn")){
      $("multiGoBtn").disabled = true;
      $("multiGoBtn").textContent = "Opening...";
    }

    try{
      const r = await api("/api/chest/open-multi", { method:"POST", body: JSON.stringify({ count: n }) });
      await refreshAll();

      const results = (r.results || []).map(x=>x.reward).filter(Boolean);
      const counts = {};
      results.forEach(x=>{
        const key = rewardLabel(x);
        counts[key] = (counts[key] || 0) + 1;
      });

      const lines = Object.entries(counts).slice(0,10).map(([k,v]) => `â€¢ x${v} ${k}`).join("\n");
      if($("multiOk")) $("multiOk").textContent = `Done âœ… Opened ${r.countOpened || results.length} chests.`;
      alert(`Opened ${r.countOpened || results.length} chests âœ…\n\nResults:\n${lines || "â€”"}`);
      closeMulti();
    }catch(e){
      if($("multiErr")) $("multiErr").textContent = e.message || "Failed.";
    }finally{
      if($("multiGoBtn")){
        $("multiGoBtn").disabled = false;
        $("multiGoBtn").textContent = "Open";
      }
    }
  }

  async function setChestBoost(){
    if($("boostErr")) $("boostErr").textContent = "";
    if($("boostOk")) $("boostOk").textContent = "";
    const mult = Number(($("boostMult")?.value||"").trim());
    const huge = Number(($("boostHuge")?.value||"").trim());
    const tok = Number(($("boostTok")?.value||"").trim());
    const mins = Number(($("boostMins")?.value||"").trim());
    try{
      await api("/api/admin/chest/boost", {
        method:"POST",
        body: JSON.stringify({ globalMultiplier: mult, hugeChanceBonus: huge, tokenBonus: tok, durationMinutes: mins })
      });
      if($("boostOk")) $("boostOk").textContent = "Boost applied âœ…";
      await refreshAll();
    }catch(e){
      if($("boostErr")) $("boostErr").textContent = e.message;
    }
  }

  async function setPetValues(){
    if($("pvErr")) $("pvErr").textContent = "";
    if($("pvOk")) $("pvOk").textContent = "";
    const hugeToGems = parseAmount($("pvHuge")?.value);
    const titanicToGems = parseAmount($("pvTitanic")?.value);

    if((!Number.isFinite(hugeToGems) || hugeToGems<=0) && (!Number.isFinite(titanicToGems) || titanicToGems<=0)){
      if($("pvErr")) $("pvErr").textContent = "Enter at least one valid value.";
      return;
    }

    try{
      await api("/api/admin/chest/pet-values", {
        method:"POST",
        body: JSON.stringify({
          hugeToGems: Number.isFinite(hugeToGems) ? hugeToGems : 0,
          titanicToGems: Number.isFinite(titanicToGems) ? titanicToGems : 0
        })
      });
      if($("pvOk")) $("pvOk").textContent = "Pet values updated âœ…";
      await refreshChest(true);
      await refreshInventory(true);
      renderAll();
    }catch(e){
      if($("pvErr")) $("pvErr").textContent = e.message;
    }
  }

  // =========================
  // âœ… INVENTORY CONVERT (pets -> gems)
  // =========================
  function openInvConvert(){
    if($("invConvErr")) $("invConvErr").textContent = "";
    if($("invConvOk")) $("invConvOk").textContent = "";
    if($("invConvType")) $("invConvType").value = "huge";
    if($("invConvCount")) $("invConvCount").value = "";
    if($("invConvPreview")) $("invConvPreview").textContent = "You will receive: â€”";
    if($("invConvModal")) $("invConvModal").style.display = "flex";

    if($("invConvType")) $("invConvType").onchange = updateInvConvPreview;
    if($("invConvCount")) $("invConvCount").oninput = updateInvConvPreview;
  }
  function closeInvConvert(){ if($("invConvModal")) $("invConvModal").style.display = "none"; }

  function petValueFromBackend(type){
    const pv = db.chest?.petValues || {};
    if(type === "huge"){
      return Number(pv.hugeToGems || UI_HUGE_TO_GEMS);
    }
    if(type === "titanic"){
      return Number(pv.titanicToGems || UI_TITANIC_TO_GEMS);
    }
    return 0;
  }

  function countStoredPets(type){
    type = String(type||"").toLowerCase();
    return (db.inventoryPets || []).filter(p =>
      String(p.type||"").toLowerCase() === type &&
      String(p.status||"stored").toLowerCase() === "stored"
    ).length;
  }

  function updateInvConvPreview(){
    const type = $("invConvType")?.value;
    const n = Math.floor(Number($("invConvCount")?.value || 0));
    const available = countStoredPets(type);
    const valueEach = petValueFromBackend(type);

    if(!Number.isFinite(n) || n<=0){
      if($("invConvPreview")) $("invConvPreview").textContent = `You will receive: â€” (Available stored: ${available})`;
      return;
    }
    const use = Math.min(n, available);
    if(use !== n && $("invConvCount")) $("invConvCount").value = String(use);

    const total = use * valueEach;
    if($("invConvPreview")) $("invConvPreview").textContent =
      `You will receive: ${fmt(total)} ğŸ’ (x${use} @ ${fmt(valueEach)} each) â€¢ Available stored: ${available}`;
  }

  async function doInvConvert(){
    if($("invConvErr")) $("invConvErr").textContent = "";
    if($("invConvOk")) $("invConvOk").textContent = "";
    if(!sessionUser){
      if($("invConvErr")) $("invConvErr").textContent = "Login first.";
      return;
    }

    const type = String($("invConvType")?.value || "").trim().toLowerCase();
    const count = Math.floor(Number($("invConvCount")?.value || 0));

    if(!["huge","titanic"].includes(type)){
      if($("invConvErr")) $("invConvErr").textContent = "Pick Huge or Titanic.";
      return;
    }
    if(!Number.isFinite(count) || count <= 0){
      if($("invConvErr")) $("invConvErr").textContent = "Enter a valid amount.";
      return;
    }

    try{
      await api("/api/inventory/convert", {
        method:"POST",
        body: JSON.stringify({ type, count })
      });

      if($("invConvOk")) $("invConvOk").textContent = "Converted âœ…";
      await refreshAll(true);
      closeInvConvert();
    }catch(e){
      if($("invConvErr")) $("invConvErr").textContent = e.message || "Convert failed.";
      await refreshMe(true);
      await refreshInventory(true);
      renderAll();
    }
  }

  // =========================
  // âœ… INVENTORY (backend-matched)
  // =========================
  async function refreshInventory(force=false){
    if(lock.inv && !force) return;
    lock.inv = true;

    try{
      if(!sessionUser){
        db.inventoryPets = [];
        return;
      }

      const r = await api("/api/inventory");
      const pets = (r && Array.isArray(r.pets)) ? r.pets : [];
      db.inventoryPets = pets;

    }catch(e){
      db.inventoryPets = db.inventoryPets || [];
    }finally{
      lock.inv = false;
    }
  }

  function renderInventory(){
    const list = $("invList");
    const empty = $("invEmpty");
    const countEl = $("invCount");

    if(!list) return;

    list.innerHTML = "";

    const pets = Array.isArray(db.inventoryPets) ? db.inventoryPets : [];

    // âœ… ONLY SHOW STORED PETS
    const stored = pets.filter(p =>
      String(p.status || "stored").toLowerCase() === "stored"
    );

    if(countEl) countEl.textContent = String(stored.length);
    if(empty) empty.style.display = stored.length ? "none" : "block";
    if(!stored.length) return;

    stored.slice(0, 80).forEach(p=>{
      const type = escapeHtml(String(p.type || "pet"));
      const id = escapeHtml(String(p.id || p._id || "â€”"));

      const icon =
        type.toLowerCase() === "titanic" ? "ğŸ›¸ğŸ‘‘" :
        type.toLowerCase() === "huge" ? "ğŸ”¥ğŸ" :
        "ğŸ¾";

      const top = `${icon} ${type.toUpperCase()} <span class="tag gray">stored</span>`;
      const sub = `ID: ${id}`;

      list.appendChild(makeItem(icon, top, sub, "ğŸ“¦"));
    });
  }

  // =========================
  // âœ… HALL OF FAME (read + render + admin)
  // =========================
  function mustEl(id){
    const el = $(id);
    if(!el) console.warn("âŒ Missing element id:", id);
    return el;
  }
  function setText(id, txt){
    const el = $(id);
    if(el) el.textContent = txt || "";
  }
  function fileToDataUrl(file){
    return new Promise((resolve, reject)=>{
      try{
        const r = new FileReader();
        r.onload = ()=>resolve(r.result || "");
        r.onerror = ()=>reject(new Error("Failed to read file"));
        r.readAsDataURL(file);
      }catch(e){
        reject(e);
      }
    });
  }

  async function refreshHOF(force=false){
    if(lock.hof && !force) return;
    lock.hof = true;

    try{
      const r = await api("/api/hof/state");
      if(r && r.hof) db.hof = r.hof;
    }catch(e){
      console.log("refreshHOF error:", e);
    }finally{
      lock.hof = false;
      try{ renderHOF(); }catch(err){ console.log("renderHOF crash:", err); }
    }
  }

  function renderHOF(){
    const grid = mustEl("hofGrid");
    const depA = mustEl("depAvatar");
    const depUser = mustEl("depUser");
    const depNote = mustEl("depNote");
    if(!grid) return;

    grid.innerHTML = "";

    const hof = db.hof || {};
    let slots = Array.isArray(hof.slots) ? hof.slots.slice(0,5) : [];
    while(slots.length < 5) slots.push({ name:"Dev", image:"" });

    slots.forEach((s, idx)=>{
      const div = document.createElement("div");
      div.className = "hofCard";

      const imgHtml = s && s.image ? `<img src="${s.image}" alt="dev">` : "";
      const name = (s && s.name) ? s.name : ("Dev #" + (idx+1));

      div.innerHTML = `
        <div class="hofCircle">${imgHtml || "ğŸ‘‘"}</div>
        <div class="hofName">${escapeHtml(name)}</div>
        <div class="hofTag"><span class="pill orange">Slot ${idx+1}</span></div>
      `;
      grid.appendChild(div);
    });

    const dep = hof.depositBox || {};
    if(depA) depA.innerHTML = dep.image ? `<img src="${dep.image}" alt="deposit">` : "ğŸ’";
    if(depUser) depUser.textContent = "@" + (dep.username || "â€”");
    if(depNote) depNote.textContent = dep.note || "â€”";
  }

  async function adminUpdateHOF(){
    setText("hofErr", "");
    setText("hofOk", "");
    if(!isAdmin){ setText("hofErr", "Admin only."); return; }

    const slotEl = mustEl("hofSlot");
    const nameEl = mustEl("hofName");
    const imgEl  = mustEl("hofImg");
    if(!slotEl || !nameEl || !imgEl){ setText("hofErr", "Missing HOF admin inputs in HTML (check IDs)."); return; }

    const slot = Math.floor(Number((slotEl.value || "").trim()));
    const name = norm(nameEl.value);
    const file = imgEl.files && imgEl.files[0] ? imgEl.files[0] : null;

    if(!Number.isFinite(slot) || slot < 1 || slot > 5){ setText("hofErr", "Slot must be 1 to 5."); return; }
    if(!name && !file){ setText("hofErr", "Enter a name and/or choose an image."); return; }

    let imageDataUrl = "";
    if(file){
      if(file.size > 2_000_000){ setText("hofErr", "Image too big (max ~2MB)."); return; }
      try{ imageDataUrl = await fileToDataUrl(file); }
      catch(e){ setText("hofErr", e.message || "Failed reading image."); return; }
    }

    try{
      await api("/api/admin/hof/update-slot", {
        method:"POST",
        body: JSON.stringify({ slot, name, imageDataUrl })
      });

      setText("hofOk", "Dev slot updated âœ…");
      imgEl.value = "";
      await refreshHOF(true);
    }catch(e){
      setText("hofErr", e.message || "Update failed.");
    }
  }

  async function adminUpdateDepositBox(){
    setText("depSetErr", "");
    setText("depSetOk", "");
    if(!isAdmin){ setText("depSetErr", "Admin only."); return; }

    const userEl = mustEl("depSetUser");
    const noteEl = mustEl("depSetNote");
    const imgEl  = mustEl("depSetImg");
    if(!userEl || !noteEl || !imgEl){ setText("depSetErr", "Missing Deposit Box admin inputs in HTML (check IDs)."); return; }

    const username = norm(userEl.value);
    const note = norm(noteEl.value);
    const file = imgEl.files && imgEl.files[0] ? imgEl.files[0] : null;

    if(!username && !note && !file){ setText("depSetErr", "Enter username/note and/or choose an image."); return; }

    let imageDataUrl = "";
    if(file){
      if(file.size > 2_000_000){ setText("depSetErr", "Image too big (max ~2MB)."); return; }
      try{ imageDataUrl = await fileToDataUrl(file); }
      catch(e){ setText("depSetErr", e.message || "Failed reading image."); return; }
    }

    try{
      await api("/api/admin/hof/update-deposit", {
        method:"POST",
        body: JSON.stringify({ username, note, imageDataUrl })
      });

      setText("depSetOk", "Deposit box saved âœ…");
      imgEl.value = "";
      await refreshHOF(true);
    }catch(e){
      setText("depSetErr", e.message || "Save failed.");
    }
  }

  // =========================
  // TITANIC ANNOUNCE
  // =========================
  function closeAnnounce(){ if($("announceModal")) $("announceModal").style.display = "none"; }

  function playTitanicSound(){
    try{
      const ctx = new (window.AudioContext || window.webkitAudioContext)();
      const t0 = ctx.currentTime;

      function beep(freq, start, dur, gain){
        const o = ctx.createOscillator();
        const g = ctx.createGain();
        o.type = "sine";
        o.frequency.setValueAtTime(freq, t0 + start);

        g.gain.setValueAtTime(0.0001, t0 + start);
        g.gain.exponentialRampToValueAtTime(gain, t0 + start + 0.02);
        g.gain.exponentialRampToValueAtTime(0.0001, t0 + start + dur);

        o.connect(g); g.connect(ctx.destination);
        o.start(t0 + start);
        o.stop(t0 + start + dur + 0.05);
      }

      beep(220, 0.00, 0.35, 0.18);
      beep(330, 0.10, 0.40, 0.16);
      beep(440, 0.22, 0.45, 0.14);
      beep(660, 0.36, 0.40, 0.12);
      beep(990, 0.52, 0.28, 0.12);
    }catch{}
  }

  function showServerAnnounce({ title, sub, big, time }){
    if($("announceTitle")) $("announceTitle").textContent = title || "ğŸš¨ SERVER ANNOUNCEMENT";
    if($("announceSub")) $("announceSub").textContent = sub || "â€”";
    if($("announceBig")) $("announceBig").textContent = big || "â€”";
    if($("announceTime")) $("announceTime").textContent = time ? new Date(time).toLocaleString() : new Date().toLocaleString();
    if($("announceModal")) $("announceModal").style.display = "flex";
    const box = $("announceModal")?.querySelector?.(".modalBox");
    if(box){ box.style.animation = "popShake .35s ease"; }
  }

  // =========================
  // EVENTS (âœ… single clean system)
  // =========================
  let _eventsCountdownTimer = null;

  async function refreshEvents(force=false){
    if(lock.events && !force) return;
    lock.events = true;

    try{
      const r = await api("/api/events/state");
      // backend returns { state: {...} } or direct { ... }
      db.eventsState = r.state || r || { mode:"coming_soon" };
    }catch{
      db.eventsState = db.eventsState || { mode:"coming_soon" };
    }finally{
      lock.events = false;
      try{ renderEvents(); }catch{}
    }
  }

  function renderEvents(){
    const st = db.eventsState || {};

    const mode = String(st.mode || "coming_soon").toLowerCase();
    const endsAt = Number(st.countdownEndsAt || 0);

    const engineEnabled = !!st.engine?.enabled;
    const title = String(st.title || "Orion Events");

    const b = st.broadcast || {};
    const bType = String(b.type || "coming_soon").toLowerCase();
    const bAdmin = String(b.admin || "");
    const bAvatar = String(b.avatarDataUrl || "");
    const bText = String(b.text || "âš« COMING SOON");
    const bTime = Number(b.time || Date.now());

    const coming = $("eventsComing");
    const liveWrap = $("eventsLive");

    const evTitle = $("eventTop");
    const evText = $("eventText");
    const evTime = $("eventTime");
    const evAvatar = $("eventAvatar");
    const evTag = $("eventTag");
    const evCountdown = $("eventCountdown");

    if(!coming || !liveWrap) return;

    // default
    coming.style.display = "flex";
    liveWrap.style.display = "none";

    const shouldShowLive = (mode === "live") || engineEnabled;

    if(shouldShowLive){
      coming.style.display = "none";
      liveWrap.style.display = "block";

      if(evTitle) evTitle.textContent = title;

      if(evTag){
        const tag =
          bType === "admin" ? `ADMIN${bAdmin ? " â€¢ " + bAdmin : ""}` :
          bType === "winner" ? "WINNER" :
          "COMING SOON";
        evTag.textContent = tag;
      }

      if(evText) evText.textContent = bText;
      if(evTime) evTime.textContent = new Date(bTime).toLocaleString();

      if(evAvatar){
        evAvatar.innerHTML = bAvatar
          ? `<img src="${bAvatar}" alt="avatar" style="width:100%;height:100%;border-radius:999px;object-fit:cover;">`
          : "";
      }

      if(evCountdown) setupEventsCountdown(evCountdown, endsAt);
    }else{
      coming.textContent = bText || "âš« COMING SOON";
      if(evCountdown) setupEventsCountdown(evCountdown, endsAt);
    }
  }

  function setupEventsCountdown(el, endsAt){
    if(_eventsCountdownTimer){
      clearInterval(_eventsCountdownTimer);
      _eventsCountdownTimer = null;
    }

    if(!endsAt || endsAt <= Date.now()){
      el.textContent = "";
      return;
    }

    const tick = () => {
      const ms = endsAt - Date.now();
      if(ms <= 0){
        el.textContent = "â³ Event time!";
        clearInterval(_eventsCountdownTimer);
        _eventsCountdownTimer = null;
        return;
      }
      const s = Math.floor(ms / 1000);
      const h = Math.floor(s / 3600);
      const m = Math.floor((s % 3600) / 60);
      const sec = s % 60;
      el.textContent = `â³ Starts in ${h}h ${m}m ${sec}s`;
    };

    tick();
    _eventsCountdownTimer = setInterval(tick, 1000);
  }

  // =========================
  // ADMIN endpoints (kept)
  // =========================
  async function setInterest(){
    if($("interestErr")) $("interestErr").textContent="";
    if($("interestOk")) $("interestOk").textContent="";
    const rate = Number(($("interestRate")?.value||"").trim());
    try{
      await api("/api/admin/interest", { method:"POST", body: JSON.stringify({ rate }) });
      if($("interestOk")) $("interestOk").textContent="Interest updated âœ…";
    }catch(e){
      if($("interestErr")) $("interestErr").textContent=e.message;
    }
  }

  async function adminAdjust(dir){
    if($("adjErr")) $("adjErr").textContent="";
    if($("adjOk")) $("adjOk").textContent="";
    const u = norm($("adjUser")?.value);
    const amt = parseAmount($("adjAmt")?.value);
    if(!u){ if($("adjErr")) $("adjErr").textContent="Enter username."; return; }
    if(!Number.isFinite(amt) || amt<=0){ if($("adjErr")) $("adjErr").textContent="Invalid amount."; return; }
    try{
      await api("/api/admin/user/balance", { method:"POST", body: JSON.stringify({ username:u, amount: amt*dir }) });
      if($("adjOk")) $("adjOk").textContent="Balance updated âœ…";
      await refreshAll();
    }catch(e){
      if($("adjErr")) $("adjErr").textContent=e.message;
    }
  }

  async function setRole(){
    if($("roleErr")) $("roleErr").textContent="";
    if($("roleOk")) $("roleOk").textContent="";
    const u = norm($("roleUser")?.value);
    const role = $("rolePick")?.value;
    if(!u){ if($("roleErr")) $("roleErr").textContent="Enter username."; return; }
    try{
      await api("/api/admin/user/role", { method:"POST", body: JSON.stringify({ username:u, role }) });
      if($("roleOk")) $("roleOk").textContent = "Role assigned âœ…";
      await refreshAll();
    }catch(e){
      if($("roleErr")) $("roleErr").textContent=e.message;
    }
  }

  async function wipeAll(){
    if($("wipeErr")) $("wipeErr").textContent="";
    if($("wipeOk")) $("wipeOk").textContent="";
    if(!confirm("This will WIPE EVERYTHING. Are you 100% sure?")) return;
    try{
      await api("/api/admin/wipe", { method:"POST" });
      if($("wipeOk")) $("wipeOk").textContent="Wiped âœ…";
      await refreshAll(true);
    }catch(e){
      if($("wipeErr")) $("wipeErr").textContent=e.message;
    }
  }

  async function createCode(){
    if($("codeErr")) $("codeErr").textContent="";
    if($("codeOk")) $("codeOk").textContent="";

    const code = norm($("newCode")?.value);
    const type = $("newCodeType")?.value;
    const amt = parseAmount($("newCodeAmt")?.value);

    const maxUses = parseAmount($("newCodeMax")?.value);
    const exp = parseAmount($("newCodeExp")?.value);
    const roleLimit = $("newCodeRole")?.value;

    if(!code){ if($("codeErr")) $("codeErr").textContent="Enter a code."; return; }
    if(!Number.isFinite(amt) || amt<=0){ if($("codeErr")) $("codeErr").textContent="Invalid amount."; return; }

    try{
      await api("/api/admin/redeem/create", {
        method:"POST",
        body: JSON.stringify({
          code,
          type,
          amount: amt,
          maxUses: Number.isFinite(maxUses) ? maxUses : 0,
          expiresMinutes: Number.isFinite(exp) ? exp : 0,
          roleLimit: roleLimit || ""
        })
      });
      if($("codeOk")) $("codeOk").textContent="Code created âœ…";
      if($("newCode")) $("newCode").value="";
      if($("newCodeAmt")) $("newCodeAmt").value="";
      if($("newCodeMax")) $("newCodeMax").value="";
      if($("newCodeExp")) $("newCodeExp").value="";
      await refreshRedeem(true);
    }catch(e){
      if($("codeErr")) $("codeErr").textContent=e.message;
    }
  }

  async function deletePost(){
    if($("delPostErr")) $("delPostErr").textContent="";
    if($("delPostOk")) $("delPostOk").textContent="";
    if(!db.selectedPostId){ if($("delPostErr")) $("delPostErr").textContent="Select a post in Blogs first."; return; }
    if(!confirm("Delete this post? This cannot be undone.")) return;

    try{
      await api("/api/admin/posts/" + encodeURIComponent(db.selectedPostId), { method:"DELETE" });
      if($("delPostOk")) $("delPostOk").textContent="Post deleted âœ…";
      db.selectedPostId = "";
      if($("postViewer")) $("postViewer").innerHTML = "Click a post to view.";
      if($("commentList")) $("commentList").innerHTML = "";
      if($("commentEmpty")) $("commentEmpty").style.display="block";
      await refreshPosts(true);
    }catch(e){
      if($("delPostErr")) $("delPostErr").textContent=e.message;
    }
  }

  // =========================
  // RENDERERS (your stitched ones)
  // =========================
  function makeItem(icon, top, sub, amtHtml=""){
    const div = document.createElement("div");
    div.className = "item";
    div.innerHTML = `
      <div class="iIcon">${icon}</div>
      <div class="iMain">
        <div class="iTop">${top}</div>
        <div class="iSub">${sub}</div>
      </div>
      <div class="iAmt">${amtHtml}</div>
    `;
    return div;
  }

  function renderTx(){
    const list = $("txList");
    if(!list) return;
    list.innerHTML = "";

    const tx = Array.isArray(db.tx) ? db.tx : [];
    if($("txEmpty")) $("txEmpty").style.display = tx.length ? "none" : "block";
    if(!tx.length) return;

    tx.slice(0, 15).forEach(t=>{
      const kind = (t.type || t.kind || "tx").toLowerCase();
      const icon =
        kind.includes("send") ? "ğŸ“¤" :
        kind.includes("recv") ? "ğŸ“¥" :
        kind.includes("deposit") ? "â•" :
        kind.includes("withdraw") ? "â–" :
        kind.includes("convert") ? "ğŸ¥" :
        "ğŸ’";

      const top = escapeHtml(t.title || t.top || t.note || kind.toUpperCase());
      const ts = Number(t.time || t.createdAt || Date.now());
      const sub = `${escapeHtml(t.sub || "")}${t.sub ? " â€¢ " : ""}${timeAgo(ts)}`;

      const amount = Number(t.amount || t.gems || 0);
      const sign = (t.sign || "").toString();
      const isNeg = sign === "-" || kind.includes("withdraw") || kind.includes("send");
      const cls = isNeg ? "neg" : "pos";
      const amtHtml = amount ? `<span class="${cls}">${isNeg ? "-" : "+"}${fmt(amount)} ğŸ’</span>` : "â€”";

      list.appendChild(makeItem(icon, top, sub, amtHtml));
    });
  }

  function renderRequests(){
    const myList = $("myReqList");
    const allList = $("allReqList");
    if(!myList || !allList) return;

    myList.innerHTML = "";
    allList.innerHTML = "";

    const reqs = Array.isArray(db.requests) ? db.requests : [];
    const me = sessionUser?.username || "";

    const mine = me ? reqs.filter(r => String(r.username || r.user || "") === me) : [];
    if($("myReqEmpty")) $("myReqEmpty").style.display = mine.length ? "none" : "block";

    mine.slice(0, 30).forEach(r=>{
      const type = String(r.type || "").toLowerCase();
      const icon = type === "deposit" ? "â•" : "â–";
      const status = String(r.status || "pending").toLowerCase();
      const stTag =
        status === "approved" ? `<span class="tag green">approved</span>` :
        status === "denied" ? `<span class="tag red">denied</span>` :
        status === "pending" ? `<span class="tag orange">pending</span>` :
        `<span class="tag gray">${escapeHtml(status)}</span>`;

      const amt = Number(r.amount || 0);
      const ts = Number(r.createdAt || r.time || Date.now());
      const top = `${icon} ${type.toUpperCase()} ${stTag}`;
      const sub = `${timeAgo(ts)} â€¢ ID: ${escapeHtml(String(r.id || r._id || "â€”"))}`;
      const amtHtml = `${fmt(amt)} ğŸ’`;

      myList.appendChild(makeItem(icon, top, sub, amtHtml));
    });

    if(!isAdmin){
      if($("allReqEmpty")){
        $("allReqEmpty").style.display = "block";
        $("allReqEmpty").textContent = "Admin only.";
      }
      return;
    }

    if($("allReqEmpty")){
      $("allReqEmpty").textContent = "No requests yet.";
      $("allReqEmpty").style.display = reqs.length ? "none" : "block";
    }

    reqs.slice(0, 40).forEach(r=>{
      const type = String(r.type || "").toLowerCase();
      const icon = type === "deposit" ? "â•" : "â–";
      const status = String(r.status || "pending").toLowerCase();

      const stTag =
        status === "approved" ? `<span class="tag green">approved</span>` :
        status === "denied" ? `<span class="tag red">denied</span>` :
        status === "pending" ? `<span class="tag orange">pending</span>` :
        `<span class="tag gray">${escapeHtml(status)}</span>`;

      const who = escapeHtml(String(r.username || r.user || "unknown"));
      const amt = Number(r.amount || 0);
      const ts = Number(r.createdAt || r.time || Date.now());
      const id = String(r.id || r._id || "");

      const top = `${icon} ${who} â€¢ ${type.toUpperCase()} ${stTag}`;
      const sub = `${timeAgo(ts)} â€¢ ID: ${escapeHtml(id || "â€”")}`;

      let amtHtml = `${fmt(amt)} ğŸ’`;

      if(status === "pending" && id){
        amtHtml = `
          <div style="display:flex;flex-direction:column;gap:8px;align-items:flex-end">
            <div>${fmt(amt)} ğŸ’</div>
            <div style="display:flex;gap:8px">
              <button class="btn green" onclick="approveReq('${id}')">Approve</button>
              <button class="btn red" onclick="denyReq('${id}')">Deny</button>
            </div>
          </div>
        `;
      }

      allList.appendChild(makeItem(icon, top, sub, amtHtml));
    });
  }

  function renderLeaderboard(){
    const podium = $("podium");
    const list = $("lbList");
    if(!podium || !list) return;

    podium.innerHTML = "";
    list.innerHTML = "";

    const lb = Array.isArray(db.leaderboard) ? db.leaderboard : [];
    if(!lb.length){
      list.appendChild(makeItem("ğŸ†", "No leaderboard yet", "â€”", "â€”"));
      return;
    }

    const top3 = lb.slice(0,3);
    top3.forEach((u, idx)=>{
      const name = escapeHtml(String(u.username || u.user || "Unknown"));
      const bal = Number(u.balance || 0);
      const av = u.avatarDataUrl || u.avatar || "";

      const div = document.createElement("div");
      div.className = "podCard";
      div.innerHTML = `
        <div class="podPlace">#${idx+1}</div>
        <div class="podAvatar">${av ? `<img src="${av}">` : ""}</div>
        <div class="podName">@${name}</div>
        <div class="podBal">${fmt(bal)} ğŸ’</div>
        <div class="podRole"><span class="${rolePillClass(roleFromBalance(bal))}">${roleFromBalance(bal)}</span></div>
      `;
      podium.appendChild(div);
    });

    lb.slice(0, 30).forEach((u, idx)=>{
      const name = escapeHtml(String(u.username || u.user || "Unknown"));
      const bal = Number(u.balance || 0);
      const role = roleFromBalance(bal);
      list.appendChild(makeItem("ğŸ†", `#${idx+1} â€¢ @${name}`, role, `${fmt(bal)} ğŸ’`));
    });
  }

  function renderChest(){
    const rewards = $("chestRewards");
    if(!rewards) return;

    rewards.innerHTML = "";

    const cost = Number(db.chest?.costTokens ?? 500);
    const maxN = maxOpensNow();

    if($("chestMeta")) $("chestMeta").textContent = `Cost: ${fmt(cost)} ğŸ¥`;
    if($("chestMaxHint")) $("chestMaxHint").textContent = `Max opens right now: ${fmt(maxN)}`;

    const arr = Array.isArray(db.chest?.rewards) ? db.chest.rewards : [];
    if($("chestRewardsEmpty")) $("chestRewardsEmpty").style.display = arr.length ? "none" : "block";

    arr.forEach(r=>{
      const label = rewardLabel(r);
      const chance = (r.chancePercent ?? r.chance ?? r.pct);
      const pctText = (chance !== undefined && chance !== null) ? `${Number(chance).toFixed(3)}%` : "â€”";
      const icon = (String(r.type||"").toLowerCase()==="titanic") ? "ğŸ›¸ğŸ‘‘"
                 : (String(r.type||"").toLowerCase()==="huge") ? "ğŸ”¥ğŸ"
                 : "ğŸ";

      const div = document.createElement("div");
      div.className = "rewardRow";
      div.innerHTML = `
        <div class="rewardLeft">
          <div class="rewardIcon">${icon}</div>
          <div class="rewardName">${escapeHtml(label)}</div>
        </div>
        <div class="rewardPct">${escapeHtml(pctText)}</div>
      `;
      rewards.appendChild(div);
    });
  }

  function renderChestFeed(){
    const list = $("chestFeed");
    if(!list) return;
    list.innerHTML = "";

    const feed = Array.isArray(db.chestFeed) ? db.chestFeed : [];
    if($("chestFeedEmpty")) $("chestFeedEmpty").style.display = feed.length ? "none" : "block";
    if(!feed.length) return;

    feed.slice(0, 40).forEach(f=>{
      const top = escapeHtml(String(f.top || ""));
      const sub = escapeHtml(String(f.sub || ""));
      const amt = (f.amt !== undefined && f.amt !== null) ? `${fmt(f.amt)} ${escapeHtml(String(f.unit || ""))}` : "â€”";
      const ts = Number(f.time || f.createdAt || Date.now());
      list.appendChild(makeItem("ğŸŒ", top || "Chest Open", `${sub}${sub ? " â€¢ " : ""}${timeAgo(ts)}`, amt));
    });
  }

  function renderProfile(){
    const loggedIn = !!sessionUser;

    if($("logoutBtn")) $("logoutBtn").style.display = loggedIn ? "block" : "none";
    if($("sideUser")) $("sideUser").textContent = loggedIn ? `Signed in as @${sessionUser.username}` : "Not signed in";
    if($("modeText")) $("modeText").textContent = loggedIn ? (isAdmin ? "Admin Mode" : "User Mode") : "Guest Mode";

    if($("nav_admin")) $("nav_admin").style.display = isAdmin ? "block" : "none";
    if($("adminPill")) $("adminPill").style.display = isAdmin ? "inline-flex" : "none";
    if($("chestAdminBox")) $("chestAdminBox").style.display = isAdmin ? "block" : "none";

    if($("welcomeTitle")) $("welcomeTitle").textContent = loggedIn ? `Welcome, @${sessionUser.username} ğŸ’` : "Welcome to Orion ğŸ’";
    if($("welcomeSub")) $("welcomeSub").textContent = loggedIn ? "Your profile is live and syncing." : "Login to access your bank profile.";

    if($("pName")) $("pName").textContent = loggedIn ? `@${sessionUser.username}` : "Guest";
    if($("recvUser")) $("recvUser").textContent = loggedIn ? sessionUser.username : "â€”";

    const bal = loggedIn ? (sessionUser.balance||0) : 0;
    const tok = loggedIn ? (sessionUser.tokens||0) : 0;
    const role = loggedIn ? (sessionUser.role || roleFromBalance(bal)) : "â€”";

    if($("balText")) $("balText").textContent = `${fmt(bal)} ğŸ’`;
    if($("dashBal")) $("dashBal").textContent = `${fmt(bal)} ğŸ’`;
    if($("dashTok")) $("dashTok").textContent = `${fmt(tok)} ğŸ¥`;
    if($("dashRole")) $("dashRole").textContent = role;

    if($("rolePill")){
      $("rolePill").className = rolePillClass(role);
      $("rolePill").textContent = `Role: ${role}`;
    }

    if($("idPill")) $("idPill").textContent = `ID: ${loggedIn ? sessionUser.id : "â€”"}`;
    if($("tokenPill")) $("tokenPill").textContent = `ğŸ¥ Tokens: ${fmt(tok)}`;

    const box = $("avatarBox");
    if(box){
      box.classList.toggle("placeholder", !loggedIn || !sessionUser.avatarDataUrl);
      if(loggedIn && sessionUser.avatarDataUrl){
        box.innerHTML = `<img src="${sessionUser.avatarDataUrl}" alt="avatar">`;
      } else {
        box.innerHTML = `<div style="font-weight:1000;opacity:.7">ğŸ‘¤</div>`;
      }
    }

    if($("statusPill")) $("statusPill").textContent = loggedIn ? "Live âœ…" : "Ready";
  }

  function renderAll(){
    try{ renderProfile(); }catch{}
    try{ renderTx(); }catch{}
    try{ renderRequests(); }catch{}
    try{ renderLeaderboard(); }catch{}
    try{ if(typeof renderRedeem === "function") renderRedeem(); }catch{}
    try{ renderChest(); }catch{}
    try{ renderChestFeed(); }catch{}
    try{ renderInventory(); }catch{}
    try{ renderEvents(); }catch{}
    try{ if(typeof renderBlogs === "function") renderBlogs(); }catch{}
    try{ renderHOF(); }catch{}
    if(isAdmin){
      try{ if(typeof renderUsersMini === "function") renderUsersMini(); }catch{}
    }
  }

  // =========================
  // REFRESHERS
  // =========================
  async function refreshMe(force=false){
    if(lock.me && !force) return;
    lock.me = true;

    try{
      if(!getToken()){
        sessionUser = null; isAdmin = false; adminLevel = "none";
        return;
      }
      const me = await api("/api/me");
      sessionUser = me.user || null;
      isAdmin = !!(me.user && me.user.isAdmin);
      adminLevel = me.user?.roles?.adminLevel || "none";
    }catch{
      clearToken();
      sessionUser = null; isAdmin = false; adminLevel = "none";
    }finally{
      lock.me = false;
    }
  }

  async function refreshState(force=false){
    if(lock.state && !force) return;
    lock.state = true;
    try{
      if(!sessionUser) return;
      const st = await api("/api/state");
      db.requests = st.requests || [];
      db.tx = st.tx || [];
    }catch{
    }finally{
      lock.state = false;
    }
  }

  async function refreshLeaderboard(force=false){
    if(lock.lb && !force) return;
    lock.lb = true;
    try{
      const r = await api("/api/leaderboard");
      db.leaderboard = r.list || r.leaderboard || [];
    }catch{
      db.leaderboard = db.leaderboard || [];
    }finally{
      lock.lb = false;
    }
  }

  async function refreshPosts(force=false){
    if(lock.posts && !force) return;
    lock.posts = true;
    try{
      const r = await api("/api/posts");
      db.posts = r.list || r.posts || [];
      if(db.selectedPostId && typeof renderPost === "function"){
        try{
          const p = await api("/api/posts/" + encodeURIComponent(db.selectedPostId));
          renderPost(p.post, p.comments||[]);
        }catch{}
      }
    }catch{
      db.posts = db.posts || [];
    }finally{
      lock.posts = false;
      try{ if(typeof renderBlogs === "function") renderBlogs(); }catch{}
    }
  }

  async function refreshRedeem(force=false){
    if(lock.redeem && !force) return;
    lock.redeem = true;
    try{
      const r = await api("/api/redeem/list");
      db.redeem = r.list || r.codes || [];
    }catch{
      db.redeem = db.redeem || [];
    }finally{
      lock.redeem = false;
    }
  }

  async function refreshChest(force=false){
    if(lock.chest && !force) return;
    lock.chest = true;
    try{
      if(!sessionUser){ db.chest = { costTokens:500, rewards:[], boosts:null, petValues:null }; return; }
      const r = await api("/api/chest/state");
      db.chest = r.chest || db.chest;
    }catch{
    }finally{
      lock.chest = false;
    }
  }

  async function refreshChestFeed(force=false){
    try{
      if(!sessionUser){ db.chestFeed = []; return; }
      const r = await api("/api/chest/feed");
      db.chestFeed = r.feed || [];

      const feed = db.chestFeed || [];
      const newest = feed[0] || null;

      if(newest){
        const fingerprint = JSON.stringify([newest.top, newest.sub, newest.amt, newest.unit]).slice(0, 220);
        const last = localStorage.getItem(LAST_ANNOUNCE_KEY) || "";

        const subText = String(newest.sub || "").toLowerCase();
        const topText = String(newest.top || "");
        const isTitanic = subText.includes("titanic") || topText.toLowerCase().includes("titanic");

        if(isTitanic && fingerprint !== last){
          localStorage.setItem(LAST_ANNOUNCE_KEY, fingerprint);
          playTitanicSound();

          let user = "Someone";
          const m = topText.match(/@([A-Za-z0-9_]{2,32})/);
          if(m) user = m[1];

          showServerAnnounce({
            title: "ğŸš¨ SERVER-WIDE TITANIC HATCH!",
            sub: "A Titanic was just hatched from the Chest ğŸ‘‘",
            big: `@${user} just hatched a TITANIC ğŸ›¸ğŸ‘‘`,
            time: newest.time || Date.now()
          });
        }
      }
    }catch{
      db.chestFeed = db.chestFeed || [];
    }finally{
      try{ renderChestFeed(); }catch{}
    }
  }

  async function refreshUsersMini(force=false){
    if(!isAdmin) return;
    if(lock.users && !force) return;
    lock.users = true;
    try{
      const r = await api("/api/admin/users-mini");
      db.usersMini = r.users || [];
    }catch{
      db.usersMini = db.usersMini || [];
    }finally{
      lock.users = false;
    }
  }

  async function refreshAll(force=false){
    await ping();
    await refreshMe(force);

    // âœ… always load Hall of Fame (guest mode too)
    await refreshHOF(force);

    if(!sessionUser){
      // still show events (guest) if backend allows it
      await refreshEvents(force);
      renderAll();
      return;
    }

    await Promise.allSettled([
      refreshState(force),
      refreshLeaderboard(force),
      refreshRedeem(force),
      refreshChest(force),
      refreshEvents(force),
      refreshUsersMini(force),
      refreshInventory(force)
    ]);

    await refreshChestFeed(force);
    await refreshPosts(force);

    if($("lastSync")) $("lastSync").textContent = "Last sync: " + new Date().toLocaleTimeString();
    renderAll();
  }

  // =========================
  // STARTUP / POLLING
  // =========================
  function startPolling(){
    if(pollTimer) clearInterval(pollTimer);

    pollTimer = setInterval(async ()=>{
      try{
        await ping();
        await refreshHOF();

        // Events can update even in guest mode
        await refreshEvents();

        if(getToken()){
          await refreshMe();
          if(sessionUser){
            await Promise.allSettled([
              refreshState(),
              refreshEvents(),
              refreshChestFeed(),
              refreshInventory()
            ]);
            if($("lastSync")) $("lastSync").textContent = "Last sync: " + new Date().toLocaleTimeString();
            renderAll();
          }
        }else{
          renderAll();
        }
      }catch{}
    }, 3000);

    setInterval(async ()=>{
      try{
        if(getToken()){
          await refreshMe();
          if(sessionUser){
            await Promise.allSettled([
              refreshLeaderboard(),
              refreshRedeem(),
              refreshChest(),
              refreshUsersMini()
            ]);
            await refreshPosts();
            renderAll();
          }
        }
      }catch{}
    }, 20000);
  }

  (async function init(){
    switchView("dash");
    await refreshAll(true);
    startPolling();
  })();
</script>
</body>
</html>